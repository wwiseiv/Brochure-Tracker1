# Phase 0: Discovery & Architecture Plan

## OBJECTIVE

Before writing ANY code, audit the existing Proposal Generator module and produce a written implementation plan. This is a PLANNING-ONLY phase. Output a structured plan document — do NOT make code changes.

---

## WHAT YOU MUST INVESTIGATE

### 1. Proposal Generator Module Structure
- Where are the Proposal Generator page/component files located?
- How is the segmented tab control (AI Workflow / Manual Upload) implemented?
  - Is it a shared component or inline?
  - How does tab switching work? (URL params, local state, router?)
  - What component renders for each tab?
- What is the route structure? (e.g., `/proposal-generator`, `/proposal-generator?tab=ai`, etc.)

### 2. Marketing Material "Create with AI" Feature
- Where is this feature's code located?
- How does the contact info overlay work?
  - Does it overlay text on a PDF page at coordinates?
  - Does it render an HTML template to PDF?
  - Does it use an image-background approach?
- What libraries/utilities does it use? (pdf-lib? puppeteer? canvas? html-pdf?)
- Where does it pull agent contact info from? (user profile model, API endpoint?)
- What is the exact overlay function signature and how is it called?

### 3. Equipment IQ System
- Where is the Equipment IQ data model / API?
- How do other features reference equipment records?
- What fields are available? (name, price, description, image?)
- Is there an existing equipment selector/picker component?

### 4. File Upload Patterns
- What upload component does the app use?
- Where are uploaded files stored? (local filesystem, S3, Cloudflare R2, etc.)
- What is the upload API endpoint pattern?
- File size limits and validation currently in place?

### 5. PDF Generation Patterns
- How does the existing AI Workflow generate its proposal PDFs?
- What library is used? (pdf-lib, puppeteer, html-pdf, pdfmake?)
- Where are generated PDFs stored?
- How is the preview/download mechanism implemented?

### 6. Permission System
- Where is the Feature Permissions logic implemented?
- How does the "Proposal Generator" toggle gate access?
  - Is it checked at the route level, component level, or API level?
  - What is the permission key/flag name?
- Confirm: does disabling "Proposal Generator" hide the entire page or just specific features?

### 7. Help Menu & AI Assistant
- Where is the help menu content defined?
- Where is the AI help assistant's knowledge/context stored or configured?
- Where are tooltips defined for existing features?

### 8. Save to Merchant Record
- Does the current Proposal Generator save generated proposals to a merchant record?
- If so, what is the data model? (proposal record linked to merchant ID?)
- What API endpoint handles the save?

### 9. Toast/Notification System
- What notification/toast component does the app use?
- How are success and error states communicated to the user?

### 10. Database / Data Layer
- What database is used? (PostgreSQL, SQLite, MongoDB, etc.)
- What ORM/query builder? (Prisma, Drizzle, Knex, raw SQL?)
- Where are schema definitions located?

---

## OUTPUT FORMAT

After investigating, produce a document with this exact structure:

```
## DISCOVERY FINDINGS

### File Locations
- Proposal Generator page: [path]
- Tab control component: [path]
- AI Workflow component: [path]
- Manual Upload component: [path]
- Marketing Material overlay utility: [path]
- Equipment IQ model/API: [path]
- Upload component: [path]
- PDF generation utility: [path]
- Permission check logic: [path]
- Help menu content: [path]
- AI assistant context: [path]
- Tooltip definitions: [path]
- Toast/notification component: [path]
- Database schema: [path]

### Tab Implementation Pattern
- Tab switching mechanism: [description]
- Adding a new tab requires: [specific steps]

### Contact Overlay Method
- Approach used: [PDF coordinate overlay / HTML-to-PDF / image background / other]
- Library: [name + version]
- Key utility function: [function name and file path]
- Agent info source: [where it pulls from]

### PDF Generation Method
- Library: [name + version]
- Generation approach: [description]
- Storage location: [path or service]
- Preview mechanism: [how preview works]

### Equipment IQ Integration
- Existing selector component: [yes/no, path if yes]
- Equipment data fields available: [list]
- API to fetch equipment: [endpoint]

### Permission Architecture
- Permission key for Proposal Generator: [key name]
- Check location: [route/component/middleware]
- Disabling hides: [entire page / specific tabs]

### Database
- Engine: [name]
- ORM: [name]
- Schema location: [path]

### Risks & Constraints
- [List anything that complicates adding a 3rd tab]
- [List any shared state that could break existing tabs]
- [List any library limitations]
```

---

## CRITICAL RULES
- Do NOT write any implementation code in this phase
- Do NOT modify any files
- Do NOT create new files (except the plan output)
- Just read, investigate, and document findings
- If you cannot determine something, say "UNKNOWN — needs manual verification" rather than guessing
