# PCB Auto â€” AI Help with Smart Navigation

## What This Does

The AI Help Assistant answers user questions about the platform **and includes tappable navigation links** in its responses. When a user taps a link, the chat closes, the app navigates to that section, and the target element highlights with a blue pulse.

No competitor has this. It replaces help docs, tooltips, and onboarding tours with a single conversational AI that both explains AND navigates.

---

## Files

```
pcb-auto-ai-help/
â”œâ”€â”€ navMap.ts              # Navigation target registry (keywords â†’ routes)
â”œâ”€â”€ useAINavigation.ts     # Hook: route navigation + highlight + toast
â”œâ”€â”€ AIMessageRenderer.tsx  # Parses [[nav:key]] tokens â†’ tappable links
â”œâ”€â”€ AIHelpChat.tsx         # Main floating chat panel component
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ aiHelp.ts          # Express API route (calls Claude)
â”œâ”€â”€ ai-help.css            # Highlight pulse + animation CSS
â””â”€â”€ README.md              # This file
```

---

## Integration Steps

### 1. Copy files into your project

```
# Frontend components â†’ client/src/components/ai-help/
cp navMap.ts useAINavigation.ts AIMessageRenderer.tsx AIHelpChat.tsx \
   â†’ client/src/components/ai-help/

# Backend route â†’ server/routes/
cp routes/aiHelp.ts â†’ server/routes/aiHelp.ts

# CSS â†’ add to your global styles
cp ai-help.css â†’ append to client/src/index.css
```

### 2. Install Anthropic SDK (if not already installed)

```bash
npm install @anthropic-ai/sdk
```

### 3. Register the API route

In your Express app (e.g., `server/index.ts` or `server/routes.ts`):

```typescript
import { aiHelpRouter } from './routes/aiHelp';

// Add after auth middleware
app.use('/api/ai-help', aiHelpRouter);
```

### 4. Add the component to your layout

In your root layout component (e.g., `App.tsx` or `Layout.tsx`):

```tsx
import { AIHelpChat } from '@/components/ai-help/AIHelpChat';

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <Router>
        {/* Your existing routes */}
        <Route path="/dashboard" component={Dashboard} />
        <Route path="/work-orders" component={WorkOrders} />
        {/* ... */}

        {/* AI Help â€” renders floating button + chat overlay */}
        <AIHelpChat />
      </Router>
    </QueryClientProvider>
  );
}
```

### 5. Add element IDs for highlight targets

For the highlight-on-navigate feature to work, add `id` attributes to your dashboard cards and section headers that match the `highlightId` values in `navMap.ts`:

```tsx
// Example in your Dashboard component:
<div id="stat-revenue" className="stat-card">
  <h3>Today's Revenue</h3>
  <span>$4,285</span>
</div>

<div id="fees-saved-card" className="fees-saved">
  <h3>Fees Saved</h3>
  <span>$2,847</span>
</div>
```

### 6. Import the CSS

In your `client/src/index.css` or global stylesheet:

```css
@import './components/ai-help/ai-help.css';
```

Or just copy the keyframes and `.ai-nav-highlight` class into your existing styles.

---

## How It Works

### The [[nav:key]] Protocol

The Claude API system prompt tells the AI about all navigable sections and instructs it to use `[[nav:key]]` markup in responses:

```
You can see your savings on your [[nav:fees-saved]] card
```

The `AIMessageRenderer` component parses these tokens and renders them as tappable `<button>` elements styled as blue pills with an arrow icon.

### Navigation Flow

1. User taps a `â†’ Fees Saved` link in an AI response
2. `handleNavigate('fees-saved')` is called
3. Chat overlay closes (300ms animation)
4. `useAINavigation` hook:
   - Calls `setLocation('/dashboard#fees-saved')` via Wouter
   - Shows a toast notification: "ğŸ“ Fees Saved â€” Dual Pricing tracker"
   - Scrolls to and highlights `#fees-saved-card` element

### Adding New Navigable Sections

Edit `navMap.ts` â€” add an entry to `NAV_MAP`:

```typescript
{
  key: 'tire-management',
  label: 'Tire Management',
  route: '/tires',
  toast: 'Tire Management Module',
  keywords: ['tires', 'tire management', 'tire rotation', 'dot registration'],
  icon: 'ğŸ›',
},
```

That's it. Claude will automatically learn about the new section because `buildNavSystemPrompt()` generates the system prompt from `NAV_MAP` at runtime.

---

## Passing Real Shop Data

The API route accepts a `shopContext` object with real-time metrics. Pull these from your database and pass them with each request:

```typescript
// In AIHelpChat.tsx, before the mutation call:
const shopContext = {
  revenue: dashboardData?.todayRevenue,
  carsInShop: dashboardData?.carsInShop,
  aro: dashboardData?.avgRepairOrder,
  approvalRate: dashboardData?.approvalRate,
  feesSaved: dashboardData?.feesSavedThisMonth,
  activeWorkOrders: dashboardData?.activeROs,
  pendingEstimates: dashboardData?.pendingEstimates,
};
```

When this data is included, Claude can answer questions like "How am I doing today?" with real numbers instead of generic explanations.

---

## Customizing Suggestions

The `/api/ai-help/suggestions` endpoint returns page-contextual quick prompts. Edit the `contextSuggestions` map in `routes/aiHelp.ts` to customize per-page suggestions.

---

## Cost Estimate

Each AI help interaction uses ~800-1200 input tokens (system prompt + history) and ~200-500 output tokens. At Claude Sonnet pricing:

- ~$0.003-$0.006 per interaction
- 100 interactions/day = ~$0.30-$0.60/day
- ~$10-$18/month per active shop

Well within margin for a $149-$199/month subscription.
