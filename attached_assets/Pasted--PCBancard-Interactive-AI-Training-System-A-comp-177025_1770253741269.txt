/**

- PCBancard Interactive AI Training System
- =========================================
- A comprehensive sales training simulator with:
- - Live AI Roleplay with dynamic merchant personas
- - Objection Gauntlet trainer
- - Delivery Analyzer
- - Scenario Simulator
- - Stage Detection Coach
- 
- Requires: React, Tailwind CSS, Claude API integration
  */

import React, { useState, useEffect, useRef, useCallback } from â€˜reactâ€™;

// ============================================================================
// MERCHANT PERSONAS - 20 Skeptical Types
// ============================================================================

interface MerchantPersona {
id: string;
name: string;
title: string;
businessType: string;
avatar: string;
difficulty: â€˜Easyâ€™ | â€˜Mediumâ€™ | â€˜Hardâ€™ | â€˜Expertâ€™;
personality: string;
openingLine: string;
triggerPhrases: string[];
objectionStyle: string;
weakPoints: string[];
systemPrompt: string;
}

const MERCHANT_PERSONAS: MerchantPersona[] = [
// === EASY DIFFICULTY ===
{
id: â€˜curious-carolâ€™,
name: â€˜Curious Carolâ€™,
title: â€˜CafÃ© Ownerâ€™,
businessType: â€˜Coffee Shopâ€™,
avatar: â€˜â˜•â€™,
difficulty: â€˜Easyâ€™,
personality: â€˜Open-minded but cautious. Asks lots of questions. Genuinely interested in learning.â€™,
openingLine: â€œHi! I got your card. Iâ€™m always looking to improve my businessâ€”what exactly do you do?â€,
triggerPhrases: [â€˜Tell me moreâ€™, â€˜How does that work?â€™, â€˜Interestingâ€¦â€™],
objectionStyle: â€˜Asks clarifying questions rather than pushing backâ€™,
weakPoints: [â€˜Responds well to educationâ€™, â€˜Appreciates patienceâ€™, â€˜Values transparencyâ€™],
systemPrompt: `You are Carol, a 45-year-old cafÃ© owner. You're genuinely curious about improving your business but want to understand things fully before deciding. You ask lots of questionsâ€”not to challenge, but to learn. You're polite and engaged. You've been in business 8 years and pay about $1,200/month in processing fees on $35,000 monthly volume. You don't know your effective rate. When the rep explains things clearly, you warm up. If they're pushy or use jargon, you get confused and hesitant.`
},
{
id: â€˜friendly-fredâ€™,
name: â€˜Friendly Fredâ€™,
title: â€˜Hardware Store Ownerâ€™,
businessType: â€˜Retail Hardwareâ€™,
avatar: â€˜ğŸ”§â€™,
difficulty: â€˜Easyâ€™,
personality: â€˜Warm and talkative. Loves to chat. Will listen if you let him talk first.â€™,
openingLine: â€œHey there! Slow morningâ€”got time to chat. What brings you by?â€,
triggerPhrases: [â€˜You know whatâ€¦â€™, â€˜That reminds me ofâ€¦â€™, â€˜My buddy has one of thoseâ€¦â€™],
objectionStyle: â€˜Goes off on tangents but is persuadable if you redirect gentlyâ€™,
weakPoints: [â€˜Wants to feel heardâ€™, â€˜Responds to storiesâ€™, â€˜Community-mindedâ€™],
systemPrompt: `You are Fred, a 58-year-old hardware store owner. You're chatty, friendly, and love to tell stories. You'll go off on tangents about your fishing trips or your grandkids. You've been with the same processor for 15 years but aren't particularly loyalâ€”just never thought about switching. You process about $50,000/month. If the rep lets you talk and seems genuinely interested, you'll listen to what they have to say. If they cut you off or seem impatient, you lose interest.`
},

// === MEDIUM DIFFICULTY ===
{
id: â€˜skeptical-samâ€™,
name: â€˜Skeptical Samâ€™,
title: â€˜Restaurant Ownerâ€™,
businessType: â€˜Family Restaurantâ€™,
avatar: â€˜ğŸ½ï¸â€™,
difficulty: â€˜Mediumâ€™,
personality: â€˜Seen it all. Cynical about sales pitches. Tests everything you say.â€™,
openingLine: â€œLet me guessâ€”youâ€™re going to save me money, right? Iâ€™ve heard that before.â€,
triggerPhrases: [â€œThatâ€™s what they all sayâ€, â€œProve itâ€, â€œIâ€™ll believe it when I see itâ€],
objectionStyle: â€˜Challenges claims directly, demands proofâ€™,
weakPoints: [â€˜Respects honesty about downsidesâ€™, â€˜Responds to specific numbersâ€™, â€˜Values directnessâ€™],
systemPrompt: `You are Sam, a 52-year-old restaurant owner who's been pitched by 50 different processor reps. You're deeply skeptical of anyone claiming to save you money. You've been burned beforeâ€”a rep promised savings and your rates went UP after 6 months. You process $80,000/month and pay about 3.2%. You'll push back hard on vague claims, but if someone is honest, specific, and acknowledges the downsides, you'll listen. You respect directness and hate BS.`
},
{
id: â€˜busy-barbaraâ€™,
name: â€˜Busy Barbaraâ€™,
title: â€˜Salon Ownerâ€™,
businessType: â€˜Hair Salonâ€™,
avatar: â€˜ğŸ’‡â€™,
difficulty: â€˜Mediumâ€™,
personality: â€˜Always rushing. Checks phone constantly. Gives you 2 minutes max.â€™,
openingLine: â€œI have a client in 5 minutes. What do you need?â€,
triggerPhrases: [â€˜Make it quickâ€™, â€˜Get to the pointâ€™, â€˜I really have to goâ€™],
objectionStyle: â€˜Uses time pressure to avoid engagementâ€™,
weakPoints: [â€˜Responds to quick winsâ€™, â€˜Appreciates efficiencyâ€™, â€˜Will schedule follow-up if intriguedâ€™],
systemPrompt: `You are Barbara, a 38-year-old salon owner who is ALWAYS busy. You're not rude, just genuinely swamped. You check your phone, glance at the door, and give short answers. You process about $25,000/month. If someone wastes your time with small talk, you shut down. But if they hook you in the first 30 seconds with something specific and valuable, you'll find time. You respond well to: "I'll take 90 secondsâ€”if it's not relevant, I'll leave."`
},
{
id: â€˜price-only-pattyâ€™,
name: â€˜Price-Only Pattyâ€™,
title: â€˜Convenience Store Ownerâ€™,
businessType: â€˜Convenience Storeâ€™,
avatar: â€˜ğŸªâ€™,
difficulty: â€˜Mediumâ€™,
personality: â€˜Only cares about the bottom line. Interrupts to ask about rates.â€™,
openingLine: â€œWhatâ€™s your rate? Thatâ€™s all I care about.â€,
triggerPhrases: [â€˜What percentage?â€™, â€˜Is that the lowest?â€™, â€˜My guy gives meâ€¦â€™],
objectionStyle: â€˜Reduces everything to rate comparisonâ€™,
weakPoints: [â€˜Responds to total cost analysisâ€™, â€˜Impressed by effective rate mathâ€™, â€˜Hates hidden feesâ€™],
systemPrompt: `You are Patty, a 44-year-old convenience store owner. You only care about one thing: the rate. You'll interrupt any pitch to ask "What's your rate?" You currently pay 2.9% but don't realize you're also paying $50 in monthly fees, $25 PCI fee, and other charges that bring your effective rate to 3.8%. You process $40,000/month. If someone can show you the TOTAL cost and prove your effective rate is higher than you think, you'll be shocked and interested. But if they can't talk numbers, you dismiss them.`
},
{
id: â€˜comparison-shopping-carlaâ€™,
name: â€˜Comparison Carlaâ€™,
title: â€˜Boutique Ownerâ€™,
businessType: â€˜Clothing Boutiqueâ€™,
avatar: â€˜ğŸ‘—â€™,
difficulty: â€˜Mediumâ€™,
personality: â€˜Getting quotes from everyone. Has a spreadsheet. Very analytical.â€™,
openingLine: â€œYouâ€™re the third processor rep this week. Iâ€™m comparing everyoneâ€”what makes you different?â€,
triggerPhrases: [â€˜The other company saidâ€¦â€™, â€˜Can you match this?â€™, â€˜I need to compareâ€™],
objectionStyle: â€˜Uses competitor quotes as leverageâ€™,
weakPoints: [â€˜Wants to feel smartâ€™, â€˜Appreciates thoroughnessâ€™, â€˜Responds to unique value propsâ€™],
systemPrompt: `You are Carla, a 35-year-old boutique owner who approaches everything analytically. You have a spreadsheet comparing 4 different processors. You process $30,000/month. You'll mention what other reps quoted you to see if this person will price-match or panic. If someone badmouths competitors, you lose trust. If someone explains WHY their approach is different (not just cheaper), you're intrigued. You respect confidence and hate desperation.`
},

// === HARD DIFFICULTY ===
{
id: â€˜loyal-larryâ€™,
name: â€˜Loyal Larryâ€™,
title: â€˜Auto Shop Ownerâ€™,
businessType: â€˜Auto Repairâ€™,
avatar: â€˜ğŸš—â€™,
difficulty: â€˜Hardâ€™,
personality: â€˜Been with the same processor for 12 years. Relationship-focused. Hates change.â€™,
openingLine: â€œMy processorâ€™s been with me since I opened. I donâ€™t switch on people.â€,
triggerPhrases: [â€œWe go way backâ€, â€œItâ€™s not about moneyâ€, â€œIâ€™m loyal to people who were there for meâ€],
objectionStyle: â€˜Frames switching as betrayal of relationshipâ€™,
weakPoints: [`Responds to "I'm not asking you to leave them"`, `Values being understood`, `Will listen if you don't attack his current processor`],
systemPrompt: `You are Larry, a 55-year-old auto shop owner. Loyalty is your core value. Your processor rep came to your shop opening 12 years ago. You know you're probably overpaying but you don't careâ€”relationships matter more. You process $60,000/month. If someone attacks your processor, you defend them and shut down. But if someone says "I'm not here to badmouth anyoneâ€”I just want to show you what's possible and let you decide," you'll listen. You need to feel like switching is YOUR choice, not being sold.`
},
{
id: â€˜burned-before-benâ€™,
name: â€˜Burned Benâ€™,
title: â€˜Pizza Shop Ownerâ€™,
businessType: â€˜Pizzeriaâ€™,
avatar: â€˜ğŸ•â€™,
difficulty: â€˜Hardâ€™,
personality: â€˜Got screwed by a previous processor. Deep distrust. Angry undertone.â€™,
openingLine: â€œLast processor told me the same thing. Six months later my rates doubled. Why should I trust you?â€,
triggerPhrases: [â€œThatâ€™s what they saidâ€, â€œIâ€™ve heard this beforeâ€, â€œYouâ€™re all the sameâ€],
objectionStyle: â€˜Projects past betrayal onto youâ€™,
weakPoints: [â€˜Responds to guarantees and protectionâ€™, â€˜Appreciates acknowledgment of industry problemsâ€™, â€˜Wants to see it in writingâ€™],
systemPrompt: `You are Ben, a 48-year-old pizza shop owner who got BURNED. Three years ago, a processor promised 1.9% and within 6 months raised it to 3.5% with hidden fees. You process $45,000/month and you're still angry about it. You assume every rep is a liar. If someone acknowledges that the industry has problems and offers concrete protection (rate locks, written guarantees, 90-day outs), you'll crack slightly. But any vague promise makes you angrier.`
},
{
id: â€˜know-it-all-kevinâ€™,
name: â€˜Know-It-All Kevinâ€™,
title: â€˜Electronics Store Ownerâ€™,
businessType: â€˜Electronics Retailâ€™,
avatar: â€˜ğŸ“±â€™,
difficulty: â€˜Hardâ€™,
personality: â€˜Thinks he understands processing better than you. Corrects everything. Condescending.â€™,
openingLine: â€œI know all about interchange. Visa charges 1.8%, Mastercard is 1.9%. You canâ€™t beat those numbers.â€,
triggerPhrases: [â€œActuallyâ€¦â€, â€œThatâ€™s not how it worksâ€, â€œIâ€™ve done my researchâ€],
objectionStyle: â€˜Tries to out-expert you with partial knowledgeâ€™,
weakPoints: [â€˜Responds to being taught something newâ€™, â€˜Ego needs strokingâ€™, â€˜Impressed by deep expertiseâ€™],
systemPrompt: `You are Kevin, a 42-year-old electronics store owner who thinks he's an expert on payment processing. You've read some articles and know terms like "interchange" and "basis points." You'll correct the rep even when you're wrong. You process $70,000/month and pay about 2.8% but think you're getting a great deal. If someone can teach you something you didn't know WITHOUT making you feel stupid, you're impressed. If they let you be wrong or seem less knowledgeable than you, you dismiss them.`
},
{
id: â€˜silent-steveâ€™,
name: â€˜Silent Steveâ€™,
title: â€˜Dry Cleaner Ownerâ€™,
businessType: â€˜Dry Cleaningâ€™,
avatar: â€˜ğŸ‘”â€™,
difficulty: â€˜Hardâ€™,
personality: â€˜Gives one-word answers. Impossible to read. Makes you fill the silence.â€™,
openingLine: â€œYeah?â€,
triggerPhrases: [â€˜Okay.â€™, â€˜Hmm.â€™, â€˜Maybe.â€™, â€˜â€¦â€™],
objectionStyle: â€˜Uses silence as a weaponâ€”makes reps nervous and over-talkâ€™,
weakPoints: [â€˜Responds to direct questionsâ€™, â€˜Appreciates not being pressuredâ€™, â€˜Opens up if you waitâ€™],
systemPrompt: `You are Steve, a 60-year-old dry cleaner owner. You're not unfriendlyâ€”just quiet. You give one-word answers and long pauses. Most salespeople get nervous and talk too much, which annoys you. You process $20,000/month. If someone asks you a direct question and then WAITS for your answer without rushing, you'll eventually open up. If they fill every silence with more talking, you shut down completely. You respect patience.`
},
{
id: â€˜contract-connieâ€™,
name: â€˜Contract Connieâ€™,
title: â€˜Gym Ownerâ€™,
businessType: â€˜Fitness Centerâ€™,
avatar: â€˜ğŸ‹ï¸â€™,
difficulty: â€˜Hardâ€™,
personality: â€˜Locked into a 3-year contract. Uses it as an excuse to not engage.â€™,
openingLine: â€œIâ€™m locked in for two more years. Thereâ€™s nothing I can do.â€,
triggerPhrases: [â€œI signed a contractâ€, â€œThereâ€™s a cancellation feeâ€, â€œI canâ€™t get outâ€],
objectionStyle: â€˜Uses contract as a wall to avoid the conversationâ€™,
weakPoints: [`Often doesn't know actual contract terms`, `Responds to "let me see the contract"`, `May have auto-renewed unknowingly`],
systemPrompt: `You are Connie, a 40-year-old gym owner who believes she's stuck in a contract. You signed something 3 years ago and assume you're locked in. In reality, your contract auto-renewed to month-to-month 8 months ago, but you don't know that. You process $55,000/month. If someone asks to actually look at your contract/statement to check, you might be surprised. You use the contract as a shield because you don't want to deal with change, but if someone proves you're NOT locked in, you have to engage.`
},

// === EXPERT DIFFICULTY ===
{
id: â€˜tech-resistant-tomâ€™,
name: â€˜Tech-Resistant Tomâ€™,
title: â€˜Diner Ownerâ€™,
businessType: â€˜Classic Dinerâ€™,
avatar: â€˜ğŸ³â€™,
difficulty: â€˜Expertâ€™,
personality: â€˜Hates new technology. Suspicious of anything digital. Cash-first mentality.â€™,
openingLine: â€œI donâ€™t trust any of that new technology. My register works fine.â€,
triggerPhrases: [â€œI like the old wayâ€, â€œThese machines break downâ€, â€œWhat happens when the internet goes out?â€],
objectionStyle: â€˜Rejects anything that sounds â€œtechyâ€ or complicatedâ€™,
weakPoints: [â€˜Responds to simplicityâ€™, â€˜Appreciates reliability storiesâ€™, â€˜Motivated by what competitors are doingâ€™],
systemPrompt: `You are Tom, a 62-year-old diner owner. You've run your business for 30 years and distrust anything new. You still use a paper ticket system. You process $35,000/month on an ancient terminal. If someone talks about "apps" or "cloud" or anything technical, you shut down. But if they explain things simplyâ€”"it's just a different terminal that does the math for you"â€”you might listen. You're motivated by not falling behind your competition.`
},
{
id: â€˜family-business-frankâ€™,
name: â€˜Family Frankâ€™,
title: â€˜Deli Ownerâ€™,
businessType: â€˜Family Deliâ€™,
avatar: â€˜ğŸ¥ªâ€™,
difficulty: â€˜Expertâ€™,
personality: â€˜His brother-in-law handles the processing. Doesn't make decisions alone.â€™,
openingLine: â€œYouâ€™d have to talk to my brother-in-law Tony. He handles all that stuff.â€,
triggerPhrases: [â€œTony takes care of thatâ€, â€œI donâ€™t make those decisionsâ€, â€œIâ€™d have to ask the familyâ€],
objectionStyle: â€˜Deflects all decision-making to absent family memberâ€™,
weakPoints: [â€˜Ask what Tony would need to seeâ€™, â€˜Offer to present to bothâ€™, â€˜Appeal to his ownership prideâ€™],
systemPrompt: `You are Frank, a 50-year-old deli owner. Your brother-in-law Tony set up the processing 10 years ago and you've never questioned it. You deflect to Tony because you genuinely don't understand processing and don't want to make a mistake. You process $40,000/month. If someone asks "What would Tony need to see to consider this?" you might engage. Or if they say "You're the ownerâ€”you should at least know what you're paying," it might spark some pride. But directly pitching you goes nowhere.`
},
{
id: â€˜cash-heavy-carlosâ€™,
name: â€˜Cash-Heavy Carlosâ€™,
title: â€˜Barber Shop Ownerâ€™,
businessType: â€˜Barber Shopâ€™,
avatar: â€˜ğŸ’ˆâ€™,
difficulty: â€˜Expertâ€™,
personality: â€˜Most of his business is cash. Doesn't think card processing matters much.â€™,
openingLine: â€œEighty percent of my customers pay cash. Processing fees arenâ€™t really my problem.â€,
triggerPhrases: [â€œCash is kingâ€, â€œI donâ€™t push cardsâ€, â€œPeople around here use cashâ€],
objectionStyle: â€˜Minimizes the importance of card processing entirelyâ€™,
weakPoints: [â€˜Ask about his 20% card customersâ€™, â€˜Discuss rising card usage trendsâ€™, â€˜Calculate what he IS payingâ€™],
systemPrompt: `You are Carlos, a 45-year-old barber shop owner. Your neighborhood is cash-heavy and you prefer it that way. But 20% of your $15,000 monthly volume IS cardsâ€”about $3,000â€”and you're paying 3.5% on that without realizing it. If someone does the math on just your card portion and shows you're losing $100+/month unnecessarily, you might care. You don't care about total volume argumentsâ€”but wasted money on the cards you DO take? That gets your attention.`
},
{
id: â€˜just-looking-janetâ€™,
name: â€˜Just-Looking Janetâ€™,
title: â€˜Gift Shop Ownerâ€™,
businessType: â€˜Gift Shopâ€™,
avatar: â€˜ğŸâ€™,
difficulty: â€˜Expertâ€™,
personality: â€˜Perpetual researcher. Never makes decisions. Always â€œnot the right time.â€â€™,
openingLine: â€œIâ€™m just gathering information right now. Not ready to make any changes.â€,
triggerPhrases: [â€œI need to think about itâ€, â€œMaybe next quarterâ€, â€œSend me some infoâ€],
objectionStyle: â€˜Endlessly delays with â€œnot yetâ€ languageâ€™,
weakPoints: [â€˜Ask what would make it the right timeâ€™, â€˜Create urgency with market changesâ€™, â€˜Offer no-commitment analysisâ€™],
systemPrompt: `You are Janet, a 47-year-old gift shop owner who has been "gathering information" about switching processors for 3 years. You're not opposedâ€”just afraid of making the wrong choice. You process $25,000/month. You've met with 6 reps and gotten quotes from all of them but never pulled the trigger. If someone asks "What would need to happen for this to be the right time?" you'll pause because you don't have a real answer. You respond to limited-time analysis offers or statements about costs of waiting.`
},
{
id: â€˜aggressive-alâ€™,
name: â€˜Aggressive Alâ€™,
title: â€˜Bar Ownerâ€™,
businessType: â€˜Sports Barâ€™,
avatar: â€˜ğŸºâ€™,
difficulty: â€˜Expertâ€™,
personality: â€˜Confrontational. Tries to intimidate. Tests your backbone.â€™,
openingLine: â€œAnother processor rep? What makes you think you wonâ€™t waste my time like the last guy?â€,
triggerPhrases: [â€œIs that the best you got?â€, â€œYouâ€™re not very convincingâ€, â€œIâ€™ve crushed better salespeople than youâ€],
objectionStyle: â€˜Attacks personally to see if you foldâ€™,
weakPoints: [â€˜Respects people who don't flinchâ€™, â€˜Responds to confidenceâ€™, â€˜Hates weakness more than high pricesâ€™],
systemPrompt: `You are Al, a 50-year-old bar owner and former college linebacker. You're aggressive and confrontationalâ€”not because you're mean, but because you respect strength. You've had weak salespeople crumble in front of you. You process $90,000/month. If someone gets defensive or apologetic, you lose all respect. But if someone pushes back calmlyâ€”"I'm not here to convince you of anything. I'm here to show you the numbers. What you do with them is up to you"â€”you'll respect that and actually listen.`
},
{
id: â€˜conspiracy-carlâ€™,
name: â€˜Conspiracy Carlâ€™,
title: â€˜Pawn Shop Ownerâ€™,
businessType: â€˜Pawn Shopâ€™,
avatar: â€˜ğŸ¦â€™,
difficulty: â€˜Expertâ€™,
personality: â€˜Thinks everyone is out to screw him. Sees hidden agendas everywhere.â€™,
openingLine: â€œWhatâ€™s the catch? Thereâ€™s always a catch. What arenâ€™t you telling me?â€,
triggerPhrases: [â€œWhatâ€™s in it for you?â€, â€œWhoâ€™s really behind this?â€, â€œI bet in 6 monthsâ€¦â€],
objectionStyle: â€˜Assumes hidden traps in everythingâ€™,
weakPoints: [â€˜Brutal honesty about how you make moneyâ€™, â€˜Transparency about the business modelâ€™, â€˜Written guaranteesâ€™],
systemPrompt: `You are Carl, a 55-year-old pawn shop owner who trusts no one. You assume every offer has a hidden catch. You want to know exactly how the rep makes money and what's in it for them. You process $50,000/month. If someone is transparentâ€”"Here's exactly how I get paid, here's what could go wrong, here's how we protect you"â€”you'll actually trust them more than someone who makes it sound perfect. Perfection makes you suspicious. Honesty about downsides makes you comfortable.`
},
{
id: â€˜multi-location-mariaâ€™,
name: â€˜Multi-Location Mariaâ€™,
title: â€˜Restaurant Group Ownerâ€™,
businessType: â€˜Restaurant Group (4 locations)â€™,
avatar: â€˜ğŸ¢â€™,
difficulty: â€˜Expertâ€™,
personality: â€˜Sophisticated buyer. Has a CFO. Needs board-level presentation.â€™,
openingLine: â€œWe process $400K monthly across four locations. This isnâ€™t a conversation for the parking lot.â€,
triggerPhrases: [â€œI need to see a formal proposalâ€, â€œMy CFO handles vendor relationshipsâ€, â€œWhatâ€™s your enterprise solution?â€],
objectionStyle: â€˜Uses corporate complexity to filter out small-time repsâ€™,
weakPoints: [â€˜Take her seriouslyâ€™, â€˜Offer formal presentationâ€™, â€˜Speak to scale and consistencyâ€™],
systemPrompt: `You are Maria, a 48-year-old owner of 4 restaurants processing $400,000/month combined. You're sophisticated and have staff who handle operations. You won't make decisions in a casual conversationâ€”you need formal proposals, references, and presentations your CFO can review. If someone treats you like a small merchant, you dismiss them. But if someone says "I understand this needs to go through your teamâ€”can I schedule a formal presentation with whoever evaluates vendors?" you'll respect that and potentially engage.`
},
{
id: â€˜new-owner-nickâ€™,
name: â€˜New Owner Nickâ€™,
title: â€˜Recently Purchased Businessâ€™,
businessType: â€˜Sandwich Shop (New Owner)â€™,
avatar: â€˜ğŸ¥–â€™,
difficulty: â€˜Mediumâ€™,
personality: â€˜Just bought the business. Overwhelmed. Doesn't know what he's paying.â€™,
openingLine: â€œI just bought this place two months ago. Iâ€™m still figuring everything out.â€,
triggerPhrases: [â€œThe previous owner set this upâ€, â€œI donâ€™t even know what weâ€™re payingâ€, â€œI have so much on my plateâ€],
objectionStyle: â€˜Uses overwhelm as a reason to delayâ€™,
weakPoints: [â€˜Offer to simplifyâ€™, â€˜Help him understand what he inheritedâ€™, â€˜Position as â€œone less thing to worry aboutâ€â€™],
systemPrompt: `You are Nick, a 35-year-old who just bought a sandwich shop 2 months ago. You inherited the previous owner's processing setup and have no idea what you're paying. You're overwhelmed with everythingâ€”vendors, employees, inventory. You process about $30,000/month. If someone offers to just LOOK at what you're currently paying and explain it to youâ€”no commitmentâ€”you'd actually appreciate that. You need help understanding your business, not another sales pitch.`
},
{
id: â€˜retiring-ritaâ€™,
name: â€˜Retiring Ritaâ€™,
title: â€˜Floristâ€™,
businessType: â€˜Flower Shopâ€™,
avatar: â€˜ğŸ’â€™,
difficulty: â€˜Hardâ€™,
personality: â€˜Planning to retire in 18 months. Doesn't see the point in changing anything.â€™,
openingLine: â€œHoney, Iâ€™m closing this shop next year. Why would I change anything now?â€,
triggerPhrases: [â€œIâ€™m winding downâ€, â€œItâ€™s not worth the hassleâ€, â€œAt my ageâ€¦â€],
objectionStyle: â€˜Uses impending retirement to avoid any changesâ€™,
weakPoints: [â€˜18 months of savings still mattersâ€™, â€˜Could increase sale valueâ€™, â€˜Less hassle, not moreâ€™],
systemPrompt: `You are Rita, a 67-year-old florist planning to retire in 18 months. You don't want to change anything because you're "almost done." You process $20,000/month and overpay by about $200/month. If someone does the mathâ€”$200 x 18 months = $3,600â€”that's real money you're throwing away. Or if they mention that having better processing could increase your business value when you sell, that might interest you. You're not opposed to moneyâ€”just opposed to hassle.`
}
];

// ============================================================================
// OBJECTION BANK
// ============================================================================

interface Objection {
id: string;
category: string;
objection: string;
difficulty: â€˜Easyâ€™ | â€˜Mediumâ€™ | â€˜Hardâ€™;
bestResponse: string;
keyPrinciples: string[];
commonMistakes: string[];
}

const OBJECTION_BANK: Objection[] = [
{
id: â€˜obj-1â€™,
category: â€˜Price/Rateâ€™,
objection: â€œYour rate is higher than what Iâ€™m paying now.â€,
difficulty: â€˜Mediumâ€™,
bestResponse: â€œI hear that a lot, and you might be rightâ€”on the surface. But let me ask: do you know your effective rate? Thatâ€™s your total fees divided by your total volume. Most merchants are surprised when they calculate it. Mind if I take a look at your statement?â€,
keyPrinciples: [â€˜Acknowledge without defendingâ€™, â€˜Pivot to effective rateâ€™, â€˜Ask permission to analyzeâ€™],
commonMistakes: [â€˜Arguing about ratesâ€™, â€˜Getting defensiveâ€™, â€˜Quoting lower rates without seeing their statementâ€™]
},
{
id: â€˜obj-2â€™,
category: â€˜Trustâ€™,
objection: â€œIâ€™ve been burned by processors before. Why should I trust you?â€,
difficulty: â€˜Hardâ€™,
bestResponse: â€œI donâ€™t blame you. This industry has a lot of bad actors. Iâ€™m not going to ask you to trust meâ€”Iâ€™m going to ask you to trust the math. Let me show you exactly what youâ€™d pay, in writing, with a 90-day guarantee that if anything is different, you can walk with no fees. Fair enough?â€,
keyPrinciples: [â€˜Validate their experienceâ€™, â€˜Don't ask for trustâ€”offer proofâ€™, â€˜Provide concrete protectionâ€™],
commonMistakes: [â€˜Saying â€œwe're differentâ€â€™, â€˜Badmouthing their previous processorâ€™, â€˜Making verbal promisesâ€™]
},
{
id: â€˜obj-3â€™,
category: â€˜Loyaltyâ€™,
objection: â€œIâ€™ve been with my processor for 10 years. Iâ€™m loyal.â€,
difficulty: â€˜Hardâ€™,
bestResponse: â€œThat says something about youâ€”loyalty matters. Iâ€™m not asking you to leave them. Iâ€™m just asking: do you know what youâ€™re paying? Most people whoâ€™ve been with the same processor for 10 years havenâ€™t looked at their rates in years. Would it hurt to know?â€,
keyPrinciples: [â€˜Honor their value (loyalty)â€™, â€˜Don't ask them to switchâ€”ask them to lookâ€™, â€˜Create curiosityâ€™],
commonMistakes: [â€˜Attacking their current processorâ€™, â€˜Dismissing loyalty as foolishâ€™, â€˜Pushing for immediate switchâ€™]
},
{
id: â€˜obj-4â€™,
category: â€˜Timeâ€™,
objection: â€œI donâ€™t have time to deal with this right now.â€,
difficulty: â€˜Mediumâ€™,
bestResponse: â€œTotally get it. Hereâ€™s what I can do in 90 seconds: Iâ€™ll tell you the one thing you should know about what youâ€™re paying, and if itâ€™s not worth your time, Iâ€™ll leave. Deal?â€,
keyPrinciples: [â€˜Respect their timeâ€™, â€˜Offer a micro-commitmentâ€™, â€˜Deliver value fastâ€™],
commonMistakes: [â€˜Asking for â€œjust 5 minutesâ€â€™, â€˜Launching into full pitch anywayâ€™, â€˜Leaving without attempting engagementâ€™]
},
{
id: â€˜obj-5â€™,
category: â€˜Customer Concernâ€™,
objection: â€œMy customers will complain if they see a fee.â€,
difficulty: â€˜Mediumâ€™,
bestResponse: â€œThatâ€™s the number one concern I hear. And hereâ€™s what actually happens: about 1 in 100 customers even mentions it. Most just choose how they want to pay. And that 1 customer? They donâ€™t leaveâ€”they just mention it. Meanwhile, youâ€™re keeping thousands in your pocket every month. Is one comment worth $15,000 a year?â€,
keyPrinciples: [â€˜Normalize the concernâ€™, â€˜Give real data (1 in 100)â€™, â€˜Reframe the mathâ€™],
commonMistakes: [â€˜Dismissing their concernâ€™, â€˜Saying â€œcustomers don't careâ€â€™, â€˜Not quantifying the trade-offâ€™]
},
{
id: â€˜obj-6â€™,
category: â€˜Competitionâ€™,
objection: â€œIâ€™m already talking to three other processor reps.â€,
difficulty: â€˜Mediumâ€™,
bestResponse: â€œGoodâ€”you should compare. Hereâ€™s what Iâ€™d look for if I were you: Ask each of them for your effective rate based on your actual statement. Whoever does that analysis honestly, without playing games, is probably the one you can trust. Want me to do that for you right now?â€,
keyPrinciples: [â€˜Encourage comparisonâ€™, â€˜Position yourself as the transparent optionâ€™, â€˜Offer immediate valueâ€™],
commonMistakes: [â€˜Panicking and dropping priceâ€™, â€˜Badmouthing competitorsâ€™, â€˜Asking who else they're talking toâ€™]
},
{
id: â€˜obj-7â€™,
category: â€˜Contractâ€™,
objection: â€œIâ€™m locked into a contract for two more years.â€,
difficulty: â€˜Hardâ€™,
bestResponse: â€œThatâ€™s what a lot of people think. Mind if I take a look? Iâ€™ve seen hundreds of contracts, and about half the time, people are actually month-to-month and donâ€™t know it. And even if there is a fee, sometimes the savings more than cover it. Can I see what you signed?â€,
keyPrinciples: [â€˜Challenge the assumptionâ€™, â€˜Offer to verifyâ€™, â€˜Math might still work even with feeâ€™],
commonMistakes: [â€˜Taking their word for itâ€™, â€˜Walking away without checkingâ€™, â€˜Saying â€œcall me when it expiresâ€â€™]
},
{
id: â€˜obj-8â€™,
category: â€˜Skepticismâ€™,
objection: â€œIf you can save me so much, why doesnâ€™t everyone do this?â€,
difficulty: â€˜Mediumâ€™,
bestResponse: â€œGreat question. Three years ago, almost no one did. Now? Over 40% of merchants are on some form of Dual Pricing. The ones who wait usually wait because theyâ€™re worried about customer reactionâ€”until they see their competitors doing it first. Then they wish they hadnâ€™t waited.â€,
keyPrinciples: [â€˜Validate the questionâ€™, â€˜Show momentum/adoptionâ€™, â€˜Create fear of falling behindâ€™],
commonMistakes: [â€˜Getting defensiveâ€™, â€˜Not having adoption dataâ€™, â€˜Making it sound too good to be trueâ€™]
},
{
id: â€˜obj-9â€™,
category: â€˜Decision Makerâ€™,
objection: â€œI need to talk to my partner/spouse/accountant first.â€,
difficulty: â€˜Mediumâ€™,
bestResponse: â€œAbsolutely. What would they need to see to feel good about this? Actually, would it make sense for me to come back when theyâ€™re here? That way they can ask questions directly.â€,
keyPrinciples: [â€˜Honor the need for consultationâ€™, â€˜Ask what they need to seeâ€™, â€˜Offer to present to bothâ€™],
commonMistakes: [â€˜Pushing for decision nowâ€™, â€˜Asking them to â€œsellâ€ their partnerâ€™, â€˜Not offering to include the other personâ€™]
},
{
id: â€˜obj-10â€™,
category: â€˜Inertiaâ€™,
objection: â€œIâ€™ll think about it.â€,
difficulty: â€˜Hardâ€™,
bestResponse: â€œI respect that. Can I askâ€”what specifically do you need to think about? Is it the numbers, the customer reaction, or something else? I ask because if thereâ€™s a specific concern, I might be able to address it right now.â€,
keyPrinciples: [â€˜Don't accept vague delaysâ€™, â€˜Ask for the real concernâ€™, â€˜Surface hidden objectionsâ€™],
commonMistakes: [â€˜Saying â€œokay, I'll follow upâ€â€™, â€˜Leaving without understanding the hesitationâ€™, â€˜Pressuring them to decide nowâ€™]
},
{
id: â€˜obj-11â€™,
category: â€˜Legalityâ€™,
objection: â€œIs Dual Pricing even legal? It sounds like a surcharge.â€,
difficulty: â€˜Easyâ€™,
bestResponse: â€œGreat questionâ€”itâ€™s totally different. Surcharging adds a fee to credit cards, which IS restricted in some states. Dual Pricing displays two pricesâ€”cash and cardâ€”and the customer chooses. Itâ€™s legal in all 50 states, fully compliant with Visa and Mastercard rules. The equipment does all the work automatically.â€,
keyPrinciples: [â€˜Clarify the difference clearlyâ€™, â€˜Emphasize legality and complianceâ€™, â€˜Make it sound simpleâ€™],
commonMistakes: [â€˜Being vague about the differenceâ€™, â€˜Not knowing state lawsâ€™, â€˜Making it sound complicatedâ€™]
},
{
id: â€˜obj-12â€™,
category: â€˜Sizeâ€™,
objection: â€œWeâ€™re too small. This probably isnâ€™t worth it for us.â€,
difficulty: â€˜Easyâ€™,
bestResponse: â€œActually, smaller businesses often benefit the most. Youâ€™re paying 3 to 4% on every card transaction. Even if you only do $20,000 a month, thatâ€™s $600 to $800 going to processing fees. What would an extra $7,000-$9,000 a year do for your business?â€,
keyPrinciples: [â€˜Flip the narrativeâ€™, â€˜Make the math specific to themâ€™, â€˜Paint the annual pictureâ€™],
commonMistakes: [â€˜Agreeing that they're too smallâ€™, â€˜Only targeting big merchantsâ€™, â€˜Not doing the mathâ€™]
}
];

// ============================================================================
// SCENARIOS
// ============================================================================

interface Scenario {
id: string;
title: string;
setup: string;
question: string;
options: { text: string; points: number; feedback: string }[];
stage: string;
}

const SCENARIOS: Scenario[] = [
{
id: â€˜scen-1â€™,
title: â€˜The Interrupted Pitchâ€™,
setup: â€œYouâ€™re 3 minutes into your presentation. The merchantâ€™s phone rings. They say â€˜I need to take thisâ€™ and step away for 2 minutes. When they come back, they seem distracted and keep glancing at their phone.â€,
question: â€˜What do you do?â€™,
options: [
{ text: â€˜Pick up exactly where you left off to maintain momentumâ€™, points: 3, feedback: â€œRiskyâ€”theyâ€™re mentally elsewhere. You might lose them.â€ },
{ text: â€˜Acknowledge the interruption and ask if now is still a good timeâ€™, points: 10, feedback: â€œPerfect. This shows respect and often re-engages them.â€ },
{ text: â€˜Summarize what you covered and ask what questions they haveâ€™, points: 7, feedback: â€œGood instinct, but check their mental state first.â€ },
{ text: â€˜Start over from the beginning to make sure they caught everythingâ€™, points: 1, feedback: â€œNoâ€”this wastes time and can feel condescending.â€ }
],
stage: â€˜Generalâ€™
},
{
id: â€˜scen-2â€™,
title: â€˜The Early Closerâ€™,
setup: â€œYouâ€™ve just finished explaining the three options (interchange-plus, surcharging, Dual Pricing). Before you can move to the proof stories, the merchant says: â€˜Okay, Dual Pricing sounds good. How do we sign up?â€™â€,
question: â€˜What do you do?â€™,
options: [
{ text: â€˜Stop the presentation and start the paperwork immediatelyâ€™, points: 5, feedback: â€œTempting, but they might have hidden concerns that surface later as buyerâ€™s remorse.â€ },
{ text: â€˜Say â€œGreat! Before we do that, let me show you what this looks like in actionâ€¦â€ and continue brieflyâ€™, points: 10, feedback: â€œSmartâ€”confirm their decision with proof while momentum is high.â€ },
{ text: â€˜Ask â€œWhat made you decide so quickly?â€ to understand their thinkingâ€™, points: 8, feedback: â€œGood for qualification, but donâ€™t overcomplicate an easy yes.â€ },
{ text: â€˜Continue the full presentation because they need all the informationâ€™, points: 2, feedback: â€œOvercomplicating. When theyâ€™re ready to buy, help them buy.â€ }
],
stage: â€˜Closingâ€™
},
{
id: â€˜scen-3â€™,
title: â€˜The Angry Competitor Mentionâ€™,
setup: â€œThe merchant says: â€˜My brother uses First Data and he says theyâ€™re way better than any of these small companies. Are you with First Data?â€™â€,
question: â€˜What do you do?â€™,
options: [
{ text: â€˜Explain why PCBancard is better than First Dataâ€™, points: 3, feedback: â€œNow youâ€™re fighting the brother. Bad move.â€ },
{ text: â€˜Say â€œFirst Data is a big company. Does your brother know what he's paying in effective rate?â€â€™, points: 10, feedback: â€œRedirects without attacking. Plants a seed of doubt through curiosity.â€ },
{ text: â€˜Avoid the question and change the subjectâ€™, points: 2, feedback: â€œEvasion looks weak. Address it, just not defensively.â€ },
{ text: â€˜Admit you're not as big and focus on personalized serviceâ€™, points: 6, feedback: â€œOkay, but youâ€™re playing defense. Better to redirect.â€ }
],
stage: â€˜Objection Handlingâ€™
},
{
id: â€˜scen-4â€™,
title: â€˜The Number Skepticâ€™,
setup: â€œYouâ€™ve just told the merchant they could save around $12,000 per year. They say: â€˜That sounds made up. No way Iâ€™m losing that much.â€™â€,
question: â€˜What do you do?â€™,
options: [
{ text: â€˜Defend the number and explain your calculationâ€™, points: 4, feedback: â€œYouâ€™ll sound defensive. They donâ€™t trust you yet.â€ },
{ text: â€˜Say â€œLet's find out togetherâ€ and analyze their statement in front of themâ€™, points: 10, feedback: â€œLet the math speak for itself. They believe their own eyes.â€ },
{ text: â€˜Reduce the estimate to sound more believableâ€™, points: 1, feedback: â€œNever negotiate against yourself. If the math is right, prove it.â€ },
{ text: â€˜Share a similar case study of another merchantâ€™, points: 6, feedback: â€œSocial proof helps, but their own numbers are more convincing.â€ }
],
stage: â€˜Problem Quantificationâ€™
},
{
id: â€˜scen-5â€™,
title: â€˜The Spouse Blockâ€™,
setup: â€œYouâ€™re at the closing stage. The merchant has agreed that Dual Pricing makes sense. Then they say: â€˜I love this, but my wife handles the finances. Sheâ€™d kill me if I signed something without her.â€™â€,
question: â€˜What do you do?â€™,
options: [
{ text: â€˜Ask them to bring the paperwork home and explain it to herâ€™, points: 3, feedback: â€œTheyâ€™ll probably never do it, and if they do, they canâ€™t answer her questions.â€ },
{ text: â€˜Offer to schedule a follow-up when both can be presentâ€™, points: 10, feedback: â€œThis shows respect and gives you the best chance to close the actual decision-maker.â€ },
{ text: â€˜Try to close them anywayâ€”they can always cancel laterâ€™, points: 0, feedback: â€œThis is pushy and will likely result in cancellation or resentment.â€ },
{ text: â€˜Leave information and say â€œHave her call me with any questionsâ€â€™, points: 4, feedback: â€œPassive. Youâ€™ll probably never hear from them. Take control of the follow-up.â€ }
],
stage: â€˜Closingâ€™
}
];

// ============================================================================
// PRESENTATION STAGES (for Stage Detection)
// ============================================================================

const PRESENTATION_STAGES = [
{ id: 1, name: â€˜Visceral Openingâ€™, keywords: [â€˜knot in your stomachâ€™, â€˜end of the monthâ€™, â€˜depositâ€™, â€˜not your faultâ€™, â€˜working for nothingâ€™, â€˜feelâ€™] },
{ id: 2, name: â€˜Problem Quantificationâ€™, keywords: [â€˜3 to 4 percentâ€™, â€˜every single swipeâ€™, â€˜nickel and dimeâ€™, â€˜how muchâ€™, â€˜payingâ€™, â€˜feesâ€™] },
{ id: 3, name: â€˜Anchor Story (Marcus)â€™, keywords: [â€˜marcusâ€™, â€˜taqueriaâ€™, â€˜17,412â€™, â€˜seventeen thousandâ€™, â€˜restaurant ownerâ€™, â€˜real personâ€™] },
{ id: 4, name: â€˜Identity Activationâ€™, keywords: [â€˜6 amâ€™, â€˜before sunriseâ€™, â€˜you're the kind of ownerâ€™, â€˜earnedâ€™, â€˜deserveâ€™, â€˜worked hardâ€™] },
{ id: 5, name: â€˜Three Optionsâ€™, keywords: [â€˜three optionsâ€™, â€˜interchangeâ€™, â€˜surchargingâ€™, â€˜dual pricingâ€™, â€˜two pricesâ€™, â€˜cash priceâ€™, â€˜card priceâ€™] },
{ id: 6, name: â€˜Objection Preventionâ€™, keywords: [â€˜customersâ€™, â€˜1 in 100â€™, â€˜thousand customersâ€™, â€˜won't complainâ€™, â€˜choose how they payâ€™] },
{ id: 7, name: â€˜Proof Story (Mike)â€™, keywords: [â€˜mikeâ€™, â€˜hvacâ€™, â€˜13,000â€™, â€˜thirteen thousandâ€™, â€˜reinvestedâ€™, â€˜growthâ€™] },
{ id: 8, name: â€˜Risk Reversal & Closeâ€™, keywords: [â€˜90 daysâ€™, â€˜guaranteeâ€™, â€˜try itâ€™, â€˜no riskâ€™, â€˜first stepâ€™, â€˜simpleâ€™, â€˜paperworkâ€™] }
];

// ============================================================================
// MAIN APPLICATION COMPONENT
// ============================================================================

type AppMode = â€˜menuâ€™ | â€˜roleplayâ€™ | â€˜objectionsâ€™ | â€˜scenariosâ€™ | â€˜analyzerâ€™;

export default function PCBancardTrainingApp() {
const [mode, setMode] = useState<AppMode>(â€˜menuâ€™);
const [selectedPersona, setSelectedPersona] = useState<MerchantPersona | null>(null);

return (
<div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white">
{/* Background Pattern */}
<div className="fixed inset-0 opacity-5">
<div className=â€œabsolute inset-0â€ style={{
backgroundImage: `url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`,
}} />
</div>

```
  {/* Content */}
  <div className="relative z-10">
    {mode === 'menu' && (
      <MainMenu 
        onSelectMode={setMode} 
        onSelectPersona={(p) => { setSelectedPersona(p); setMode('roleplay'); }}
      />
    )}
    {mode === 'roleplay' && selectedPersona && (
      <RoleplaySimulator 
        persona={selectedPersona} 
        onBack={() => { setMode('menu'); setSelectedPersona(null); }}
      />
    )}
    {mode === 'objections' && (
      <ObjectionGauntlet onBack={() => setMode('menu')} />
    )}
    {mode === 'scenarios' && (
      <ScenarioTrainer onBack={() => setMode('menu')} />
    )}
    {mode === 'analyzer' && (
      <DeliveryAnalyzer onBack={() => setMode('menu')} />
    )}
  </div>
</div>
```

);
}

// ============================================================================
// MAIN MENU
// ============================================================================

interface MainMenuProps {
onSelectMode: (mode: AppMode) => void;
onSelectPersona: (persona: MerchantPersona) => void;
}

function MainMenu({ onSelectMode, onSelectPersona }: MainMenuProps) {
const [showPersonas, setShowPersonas] = useState(false);
const [personaFilter, setPersonaFilter] = useState<â€˜allâ€™ | â€˜Easyâ€™ | â€˜Mediumâ€™ | â€˜Hardâ€™ | â€˜Expertâ€™>(â€˜allâ€™);

const filteredPersonas = personaFilter === â€˜allâ€™
? MERCHANT_PERSONAS
: MERCHANT_PERSONAS.filter(p => p.difficulty === personaFilter);

return (
<div className="container mx-auto px-4 py-12">
{/* Header */}
<div className="text-center mb-16">
<div className="inline-flex items-center gap-2 px-4 py-2 bg-emerald-500/20 border border-emerald-500/30 rounded-full text-emerald-400 text-sm mb-6">
<span className="relative flex h-2 w-2">
<span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
<span className="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
</span>
AI-Powered Training
</div>
<h1 className="text-5xl font-bold mb-4 bg-gradient-to-r from-white via-white to-emerald-400 bg-clip-text text-transparent">
PCBancard Sales Training
</h1>
<p className="text-xl text-slate-400 max-w-2xl mx-auto">
Master the Dual Pricing presentation through AI-powered roleplay,
objection handling, and real-time coaching.
</p>
</div>

```
  {/* Training Modes */}
  {!showPersonas ? (
    <div className="grid md:grid-cols-2 gap-6 max-w-4xl mx-auto mb-12">
      {/* Roleplay Card */}
      <button
        onClick={() => setShowPersonas(true)}
        className="group relative p-8 bg-gradient-to-br from-slate-800/50 to-slate-800/30 border border-slate-700/50 rounded-2xl text-left transition-all hover:border-emerald-500/50 hover:shadow-lg hover:shadow-emerald-500/10"
      >
        <div className="absolute top-4 right-4 px-3 py-1 bg-emerald-500/20 rounded-full text-emerald-400 text-xs font-medium">
          20 Personas
        </div>
        <div className="text-4xl mb-4">ğŸ­</div>
        <h3 className="text-2xl font-bold mb-2 group-hover:text-emerald-400 transition-colors">Live Roleplay</h3>
        <p className="text-slate-400">
          Practice against AI merchants with unique personalities. 
          From easy conversations to expert-level skeptics.
        </p>
      </button>
      
      {/* Objection Gauntlet */}
      <button
        onClick={() => onSelectMode('objections')}
        className="group relative p-8 bg-gradient-to-br from-slate-800/50 to-slate-800/30 border border-slate-700/50 rounded-2xl text-left transition-all hover:border-orange-500/50 hover:shadow-lg hover:shadow-orange-500/10"
      >
        <div className="absolute top-4 right-4 px-3 py-1 bg-orange-500/20 rounded-full text-orange-400 text-xs font-medium">
          12 Objections
        </div>
        <div className="text-4xl mb-4">âš”ï¸</div>
        <h3 className="text-2xl font-bold mb-2 group-hover:text-orange-400 transition-colors">Objection Gauntlet</h3>
        <p className="text-slate-400">
          Rapid-fire objection handling. Get scored on your responses 
          and learn the best techniques.
        </p>
      </button>
      
      {/* Scenario Trainer */}
      <button
        onClick={() => onSelectMode('scenarios')}
        className="group relative p-8 bg-gradient-to-br from-slate-800/50 to-slate-800/30 border border-slate-700/50 rounded-2xl text-left transition-all hover:border-blue-500/50 hover:shadow-lg hover:shadow-blue-500/10"
      >
        <div className="absolute top-4 right-4 px-3 py-1 bg-blue-500/20 rounded-full text-blue-400 text-xs font-medium">
          Situational
        </div>
        <div className="text-4xl mb-4">ğŸ¯</div>
        <h3 className="text-2xl font-bold mb-2 group-hover:text-blue-400 transition-colors">Scenario Trainer</h3>
        <p className="text-slate-400">
          "What would you do?" situations. Test your judgment 
          with realistic sales scenarios.
        </p>
      </button>
      
      {/* Delivery Analyzer */}
      <button
        onClick={() => onSelectMode('analyzer')}
        className="group relative p-8 bg-gradient-to-br from-slate-800/50 to-slate-800/30 border border-slate-700/50 rounded-2xl text-left transition-all hover:border-purple-500/50 hover:shadow-lg hover:shadow-purple-500/10"
      >
        <div className="absolute top-4 right-4 px-3 py-1 bg-purple-500/20 rounded-full text-purple-400 text-xs font-medium">
          AI Analysis
        </div>
        <div className="text-4xl mb-4">ğŸ“Š</div>
        <h3 className="text-2xl font-bold mb-2 group-hover:text-purple-400 transition-colors">Delivery Analyzer</h3>
        <p className="text-slate-400">
          Practice your full presentation. AI detects which stages 
          you hit and coaches your delivery.
        </p>
      </button>
    </div>
  ) : (
    /* Persona Selection */
    <div className="max-w-6xl mx-auto">
      <div className="flex items-center justify-between mb-8">
        <button
          onClick={() => setShowPersonas(false)}
          className="flex items-center gap-2 text-slate-400 hover:text-white transition-colors"
        >
          â† Back to Menu
        </button>
        
        {/* Difficulty Filter */}
        <div className="flex gap-2">
          {(['all', 'Easy', 'Medium', 'Hard', 'Expert'] as const).map((level) => (
            <button
              key={level}
              onClick={() => setPersonaFilter(level)}
              className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${
                personaFilter === level
                  ? level === 'Easy' ? 'bg-green-500/20 text-green-400 border border-green-500/30'
                  : level === 'Medium' ? 'bg-yellow-500/20 text-yellow-400 border border-yellow-500/30'
                  : level === 'Hard' ? 'bg-orange-500/20 text-orange-400 border border-orange-500/30'
                  : level === 'Expert' ? 'bg-red-500/20 text-red-400 border border-red-500/30'
                  : 'bg-slate-700/50 text-white border border-slate-600'
                  : 'bg-slate-800/50 text-slate-400 border border-transparent hover:border-slate-600'
              }`}
            >
              {level === 'all' ? 'All Levels' : level}
            </button>
          ))}
        </div>
      </div>
      
      <h2 className="text-3xl font-bold mb-6">Select a Merchant</h2>
      
      <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
        {filteredPersonas.map((persona) => (
          <button
            key={persona.id}
            onClick={() => onSelectPersona(persona)}
            className="group p-6 bg-slate-800/50 border border-slate-700/50 rounded-xl text-left transition-all hover:border-emerald-500/50 hover:bg-slate-800"
          >
            <div className="flex items-start justify-between mb-3">
              <span className="text-3xl">{persona.avatar}</span>
              <span className={`px-2 py-1 rounded text-xs font-medium ${
                persona.difficulty === 'Easy' ? 'bg-green-500/20 text-green-400'
                : persona.difficulty === 'Medium' ? 'bg-yellow-500/20 text-yellow-400'
                : persona.difficulty === 'Hard' ? 'bg-orange-500/20 text-orange-400'
                : 'bg-red-500/20 text-red-400'
              }`}>
                {persona.difficulty}
              </span>
            </div>
            <h3 className="text-lg font-bold mb-1 group-hover:text-emerald-400 transition-colors">
              {persona.name}
            </h3>
            <p className="text-sm text-slate-500 mb-2">{persona.title} â€¢ {persona.businessType}</p>
            <p className="text-sm text-slate-400 line-clamp-2">{persona.personality}</p>
          </button>
        ))}
      </div>
    </div>
  )}
</div>
```

);
}

// ============================================================================
// ROLEPLAY SIMULATOR
// ============================================================================

interface Message {
role: â€˜userâ€™ | â€˜merchantâ€™ | â€˜systemâ€™;
content: string;
timestamp: Date;
}

interface RoleplaySimulatorProps {
persona: MerchantPersona;
onBack: () => void;
}

function RoleplaySimulator({ persona, onBack }: RoleplaySimulatorProps) {
const [messages, setMessages] = useState<Message[]>([
{ role: â€˜merchantâ€™, content: persona.openingLine, timestamp: new Date() }
]);
const [input, setInput] = useState(â€™â€™);
const [isLoading, setIsLoading] = useState(false);
const [sessionStats, setSessionStats] = useState({ exchanges: 0, startTime: new Date() });
const [showCoaching, setShowCoaching] = useState(false);
const [coachingFeedback, setCoachingFeedback] = useState<string | null>(null);
const messagesEndRef = useRef<HTMLDivElement>(null);

const scrollToBottom = () => {
messagesEndRef.current?.scrollIntoView({ behavior: â€˜smoothâ€™ });
};

useEffect(() => {
scrollToBottom();
}, [messages]);

const handleSend = async () => {
if (!input.trim() || isLoading) return;

```
const userMessage: Message = {
  role: 'user',
  content: input.trim(),
  timestamp: new Date()
};

setMessages(prev => [...prev, userMessage]);
setInput('');
setIsLoading(true);

// Simulate AI response (In production, this calls Claude API)
// This is a placeholder - see the API integration code below
setTimeout(() => {
  const merchantResponse: Message = {
    role: 'merchant',
    content: generateMerchantResponse(persona, input.trim(), messages),
    timestamp: new Date()
  };
  setMessages(prev => [...prev, merchantResponse]);
  setSessionStats(prev => ({ ...prev, exchanges: prev.exchanges + 1 }));
  setIsLoading(false);
}, 1000 + Math.random() * 1000);
```

};

const requestCoaching = async () => {
setShowCoaching(true);
setCoachingFeedback(null);

```
// Simulate coaching analysis
setTimeout(() => {
  setCoachingFeedback(generateCoachingFeedback(messages, persona));
}, 1500);
```

};

const getElapsedTime = () => {
const diff = Math.floor((new Date().getTime() - sessionStats.startTime.getTime()) / 1000);
const minutes = Math.floor(diff / 60);
const seconds = diff % 60;
return `${minutes}:${seconds.toString().padStart(2, '0')}`;
};

return (
<div className="h-screen flex flex-col">
{/* Header */}
<div className="bg-slate-800/50 border-b border-slate-700/50 px-6 py-4">
<div className="flex items-center justify-between">
<div className="flex items-center gap-4">
<button
onClick={onBack}
className="p-2 hover:bg-slate-700/50 rounded-lg transition-colors"
>
â†
</button>
<div className="flex items-center gap-3">
<span className="text-3xl">{persona.avatar}</span>
<div>
<h2 className="font-bold">{persona.name}</h2>
<p className="text-sm text-slate-400">{persona.businessType}</p>
</div>
</div>
<span className={`px-2 py-1 rounded text-xs font-medium ${ persona.difficulty === 'Easy' ? 'bg-green-500/20 text-green-400' : persona.difficulty === 'Medium' ? 'bg-yellow-500/20 text-yellow-400' : persona.difficulty === 'Hard' ? 'bg-orange-500/20 text-orange-400' : 'bg-red-500/20 text-red-400' }`}>
{persona.difficulty}
</span>
</div>

```
      <div className="flex items-center gap-6">
        <div className="text-right">
          <p className="text-xs text-slate-500">Session Time</p>
          <p className="font-mono text-emerald-400">{getElapsedTime()}</p>
        </div>
        <div className="text-right">
          <p className="text-xs text-slate-500">Exchanges</p>
          <p className="font-mono text-emerald-400">{sessionStats.exchanges}</p>
        </div>
        <button
          onClick={requestCoaching}
          className="px-4 py-2 bg-purple-500/20 border border-purple-500/30 rounded-lg text-purple-400 hover:bg-purple-500/30 transition-colors"
        >
          ğŸ¤– Get Coaching
        </button>
      </div>
    </div>
  </div>
  
  {/* Persona Info Bar */}
  <div className="bg-slate-800/30 border-b border-slate-700/30 px-6 py-3">
    <div className="flex gap-6 text-sm">
      <div>
        <span className="text-slate-500">Personality: </span>
        <span className="text-slate-300">{persona.personality}</span>
      </div>
      <div>
        <span className="text-slate-500">Objection Style: </span>
        <span className="text-slate-300">{persona.objectionStyle}</span>
      </div>
    </div>
  </div>
  
  {/* Messages */}
  <div className="flex-1 overflow-y-auto p-6 space-y-4">
    {messages.map((msg, idx) => (
      <div
        key={idx}
        className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}
      >
        <div className={`max-w-2xl rounded-2xl px-5 py-3 ${
          msg.role === 'user'
            ? 'bg-emerald-600 text-white'
            : msg.role === 'merchant'
            ? 'bg-slate-700/50 text-white'
            : 'bg-purple-500/20 text-purple-300 border border-purple-500/30'
        }`}>
          {msg.role === 'merchant' && (
            <div className="flex items-center gap-2 mb-1">
              <span>{persona.avatar}</span>
              <span className="text-sm font-medium text-slate-400">{persona.name}</span>
            </div>
          )}
          <p className="whitespace-pre-wrap">{msg.content}</p>
        </div>
      </div>
    ))}
    
    {isLoading && (
      <div className="flex justify-start">
        <div className="bg-slate-700/50 rounded-2xl px-5 py-3">
          <div className="flex items-center gap-2">
            <span>{persona.avatar}</span>
            <div className="flex gap-1">
              <span className="w-2 h-2 bg-slate-400 rounded-full animate-bounce" style={{ animationDelay: '0ms' }} />
              <span className="w-2 h-2 bg-slate-400 rounded-full animate-bounce" style={{ animationDelay: '150ms' }} />
              <span className="w-2 h-2 bg-slate-400 rounded-full animate-bounce" style={{ animationDelay: '300ms' }} />
            </div>
          </div>
        </div>
      </div>
    )}
    
    <div ref={messagesEndRef} />
  </div>
  
  {/* Input */}
  <div className="bg-slate-800/50 border-t border-slate-700/50 p-4">
    <div className="flex gap-4 max-w-4xl mx-auto">
      <input
        type="text"
        value={input}
        onChange={(e) => setInput(e.target.value)}
        onKeyPress={(e) => e.key === 'Enter' && handleSend()}
        placeholder="Type your response..."
        className="flex-1 bg-slate-700/50 border border-slate-600/50 rounded-xl px-5 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50"
      />
      <button
        onClick={handleSend}
        disabled={!input.trim() || isLoading}
        className="px-6 py-3 bg-emerald-600 hover:bg-emerald-500 disabled:bg-slate-700 disabled:text-slate-500 rounded-xl font-medium transition-colors"
      >
        Send
      </button>
    </div>
    <p className="text-center text-xs text-slate-500 mt-2">
      Press Enter to send â€¢ Click "Get Coaching" for AI feedback on your approach
    </p>
  </div>
  
  {/* Coaching Sidebar */}
  {showCoaching && (
    <div className="fixed right-0 top-0 h-full w-96 bg-slate-900 border-l border-slate-700/50 shadow-2xl overflow-y-auto">
      <div className="p-6">
        <div className="flex items-center justify-between mb-6">
          <h3 className="text-lg font-bold">ğŸ¤– AI Coach</h3>
          <button
            onClick={() => setShowCoaching(false)}
            className="p-2 hover:bg-slate-700/50 rounded-lg"
          >
            âœ•
          </button>
        </div>
        
        {coachingFeedback ? (
          <div className="space-y-6">
            <div className="prose prose-invert prose-sm">
              <div dangerouslySetInnerHTML={{ __html: coachingFeedback }} />
            </div>
            
            <div className="p-4 bg-emerald-500/10 border border-emerald-500/30 rounded-lg">
              <h4 className="font-medium text-emerald-400 mb-2">ğŸ’¡ Weak Points to Target</h4>
              <ul className="text-sm text-slate-300 space-y-1">
                {persona.weakPoints.map((wp, i) => (
                  <li key={i}>â€¢ {wp}</li>
                ))}
              </ul>
            </div>
          </div>
        ) : (
          <div className="flex flex-col items-center justify-center h-64">
            <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500 mb-4" />
            <p className="text-slate-400">Analyzing conversation...</p>
          </div>
        )}
      </div>
    </div>
  )}
</div>
```

);
}

// ============================================================================
// OBJECTION GAUNTLET
// ============================================================================

interface ObjectionGauntletProps {
onBack: () => void;
}

function ObjectionGauntlet({ onBack }: ObjectionGauntletProps) {
const [currentIndex, setCurrentIndex] = useState(0);
const [userResponse, setUserResponse] = useState(â€™â€™);
const [showFeedback, setShowFeedback] = useState(false);
const [score, setScore] = useState(0);
const [completed, setCompleted] = useState<string[]>([]);

// Shuffle objections for variety
const [objections] = useState(() =>
[â€¦OBJECTION_BANK].sort(() => Math.random() - 0.5)
);

const currentObjection = objections[currentIndex];

const handleSubmit = () => {
setShowFeedback(true);
// Simple scoring based on key principles mentioned
let responseScore = 5; // Base score
const lowerResponse = userResponse.toLowerCase();

```
currentObjection.keyPrinciples.forEach(principle => {
  if (lowerResponse.includes(principle.toLowerCase().split(' ')[0])) {
    responseScore += 1;
  }
});

currentObjection.commonMistakes.forEach(mistake => {
  if (lowerResponse.includes(mistake.toLowerCase().split(' ')[0])) {
    responseScore -= 1;
  }
});

setScore(prev => prev + Math.max(1, Math.min(10, responseScore)));
setCompleted(prev => [...prev, currentObjection.id]);
```

};

const nextObjection = () => {
if (currentIndex < objections.length - 1) {
setCurrentIndex(prev => prev + 1);
setUserResponse(â€™â€™);
setShowFeedback(false);
}
};

return (
<div className="min-h-screen p-6">
{/* Header */}
<div className="max-w-4xl mx-auto mb-8">
<div className="flex items-center justify-between">
<button
onClick={onBack}
className="flex items-center gap-2 text-slate-400 hover:text-white transition-colors"
>
â† Back to Menu
</button>
<div className="flex items-center gap-6">
<div className="text-right">
<p className="text-xs text-slate-500">Progress</p>
<p className="font-mono text-orange-400">{completed.length} / {objections.length}</p>
</div>
<div className="text-right">
<p className="text-xs text-slate-500">Score</p>
<p className="font-mono text-orange-400">{score}</p>
</div>
</div>
</div>
</div>

```
  {/* Objection Card */}
  <div className="max-w-4xl mx-auto">
    <div className="bg-slate-800/50 border border-slate-700/50 rounded-2xl overflow-hidden">
      {/* Objection Header */}
      <div className="bg-orange-500/10 border-b border-orange-500/20 p-6">
        <div className="flex items-center justify-between mb-4">
          <span className="px-3 py-1 bg-orange-500/20 rounded-full text-orange-400 text-sm">
            {currentObjection.category}
          </span>
          <span className={`px-3 py-1 rounded-full text-sm ${
            currentObjection.difficulty === 'Easy' ? 'bg-green-500/20 text-green-400'
            : currentObjection.difficulty === 'Medium' ? 'bg-yellow-500/20 text-yellow-400'
            : 'bg-red-500/20 text-red-400'
          }`}>
            {currentObjection.difficulty}
          </span>
        </div>
        <h2 className="text-2xl font-bold mb-2">Merchant says:</h2>
        <p className="text-xl text-orange-300">"{currentObjection.objection}"</p>
      </div>
      
      {/* Response Area */}
      <div className="p-6">
        <label className="block text-sm text-slate-400 mb-2">Your Response:</label>
        <textarea
          value={userResponse}
          onChange={(e) => setUserResponse(e.target.value)}
          disabled={showFeedback}
          placeholder="How would you respond to this objection?"
          className="w-full h-32 bg-slate-700/50 border border-slate-600/50 rounded-xl p-4 text-white placeholder-slate-500 focus:outline-none focus:border-orange-500/50 disabled:opacity-50"
        />
        
        {!showFeedback && (
          <button
            onClick={handleSubmit}
            disabled={!userResponse.trim()}
            className="mt-4 w-full py-3 bg-orange-600 hover:bg-orange-500 disabled:bg-slate-700 disabled:text-slate-500 rounded-xl font-medium transition-colors"
          >
            Submit Response
          </button>
        )}
      </div>
      
      {/* Feedback */}
      {showFeedback && (
        <div className="border-t border-slate-700/50 p-6 space-y-6">
          <div className="p-4 bg-emerald-500/10 border border-emerald-500/30 rounded-xl">
            <h3 className="font-bold text-emerald-400 mb-2">âœ… Best Response Approach:</h3>
            <p className="text-slate-300">{currentObjection.bestResponse}</p>
          </div>
          
          <div className="grid md:grid-cols-2 gap-4">
            <div className="p-4 bg-blue-500/10 border border-blue-500/30 rounded-xl">
              <h4 className="font-medium text-blue-400 mb-2">Key Principles:</h4>
              <ul className="text-sm text-slate-300 space-y-1">
                {currentObjection.keyPrinciples.map((p, i) => (
                  <li key={i}>â€¢ {p}</li>
                ))}
              </ul>
            </div>
            
            <div className="p-4 bg-red-500/10 border border-red-500/30 rounded-xl">
              <h4 className="font-medium text-red-400 mb-2">Common Mistakes:</h4>
              <ul className="text-sm text-slate-300 space-y-1">
                {currentObjection.commonMistakes.map((m, i) => (
                  <li key={i}>â€¢ {m}</li>
                ))}
              </ul>
            </div>
          </div>
          
          {currentIndex < objections.length - 1 ? (
            <button
              onClick={nextObjection}
              className="w-full py-3 bg-orange-600 hover:bg-orange-500 rounded-xl font-medium transition-colors"
            >
              Next Objection â†’
            </button>
          ) : (
            <div className="text-center py-6">
              <h3 className="text-2xl font-bold mb-2">ğŸ‰ Gauntlet Complete!</h3>
              <p className="text-slate-400 mb-4">Final Score: {score} points</p>
              <button
                onClick={onBack}
                className="px-6 py-3 bg-orange-600 hover:bg-orange-500 rounded-xl font-medium transition-colors"
              >
                Back to Menu
              </button>
            </div>
          )}
        </div>
      )}
    </div>
  </div>
</div>
```

);
}

// ============================================================================
// SCENARIO TRAINER
// ============================================================================

interface ScenarioTrainerProps {
onBack: () => void;
}

function ScenarioTrainer({ onBack }: ScenarioTrainerProps) {
const [currentIndex, setCurrentIndex] = useState(0);
const [selectedOption, setSelectedOption] = useState<number | null>(null);
const [totalScore, setTotalScore] = useState(0);
const [completed, setCompleted] = useState(0);

const scenario = SCENARIOS[currentIndex];

const handleSelect = (optionIndex: number) => {
if (selectedOption !== null) return;
setSelectedOption(optionIndex);
setTotalScore(prev => prev + scenario.options[optionIndex].points);
setCompleted(prev => prev + 1);
};

const nextScenario = () => {
if (currentIndex < SCENARIOS.length - 1) {
setCurrentIndex(prev => prev + 1);
setSelectedOption(null);
}
};

return (
<div className="min-h-screen p-6">
{/* Header */}
<div className="max-w-4xl mx-auto mb-8">
<div className="flex items-center justify-between">
<button
onClick={onBack}
className="flex items-center gap-2 text-slate-400 hover:text-white transition-colors"
>
â† Back to Menu
</button>
<div className="flex items-center gap-6">
<div className="text-right">
<p className="text-xs text-slate-500">Progress</p>
<p className="font-mono text-blue-400">{completed} / {SCENARIOS.length}</p>
</div>
<div className="text-right">
<p className="text-xs text-slate-500">Score</p>
<p className="font-mono text-blue-400">{totalScore}</p>
</div>
</div>
</div>
</div>

```
  {/* Scenario Card */}
  <div className="max-w-4xl mx-auto">
    <div className="bg-slate-800/50 border border-slate-700/50 rounded-2xl overflow-hidden">
      <div className="p-6 border-b border-slate-700/50">
        <div className="flex items-center gap-3 mb-4">
          <span className="text-2xl">ğŸ¯</span>
          <h2 className="text-xl font-bold">{scenario.title}</h2>
          <span className="px-3 py-1 bg-blue-500/20 rounded-full text-blue-400 text-sm">
            {scenario.stage}
          </span>
        </div>
        <p className="text-slate-300 leading-relaxed">{scenario.setup}</p>
      </div>
      
      <div className="p-6">
        <h3 className="text-lg font-medium mb-4">{scenario.question}</h3>
        <div className="space-y-3">
          {scenario.options.map((option, idx) => (
            <button
              key={idx}
              onClick={() => handleSelect(idx)}
              disabled={selectedOption !== null}
              className={`w-full text-left p-4 rounded-xl border transition-all ${
                selectedOption === null
                  ? 'bg-slate-700/30 border-slate-600/50 hover:border-blue-500/50 hover:bg-slate-700/50'
                  : selectedOption === idx
                    ? option.points >= 8
                      ? 'bg-emerald-500/20 border-emerald-500/50'
                      : option.points >= 5
                      ? 'bg-yellow-500/20 border-yellow-500/50'
                      : 'bg-red-500/20 border-red-500/50'
                    : 'bg-slate-800/30 border-slate-700/30 opacity-50'
              }`}
            >
              <div className="flex items-start justify-between gap-4">
                <span className="text-slate-300">{option.text}</span>
                {selectedOption === idx && (
                  <span className={`px-2 py-1 rounded text-xs font-medium ${
                    option.points >= 8 ? 'bg-emerald-500/20 text-emerald-400'
                    : option.points >= 5 ? 'bg-yellow-500/20 text-yellow-400'
                    : 'bg-red-500/20 text-red-400'
                  }`}>
                    {option.points}/10
                  </span>
                )}
              </div>
              {selectedOption !== null && (
                <p className="mt-2 text-sm text-slate-400">{option.feedback}</p>
              )}
            </button>
          ))}
        </div>
      </div>
      
      {selectedOption !== null && (
        <div className="p-6 border-t border-slate-700/50">
          {currentIndex < SCENARIOS.length - 1 ? (
            <button
              onClick={nextScenario}
              className="w-full py-3 bg-blue-600 hover:bg-blue-500 rounded-xl font-medium transition-colors"
            >
              Next Scenario â†’
            </button>
          ) : (
            <div className="text-center">
              <h3 className="text-2xl font-bold mb-2">ğŸ‰ All Scenarios Complete!</h3>
              <p className="text-slate-400 mb-4">
                Final Score: {totalScore} / {SCENARIOS.length * 10} 
                ({Math.round(totalScore / (SCENARIOS.length * 10) * 100)}%)
              </p>
              <button
                onClick={onBack}
                className="px-6 py-3 bg-blue-600 hover:bg-blue-500 rounded-xl font-medium"
              >
                Back to Menu
              </button>
            </div>
          )}
        </div>
      )}
    </div>
  </div>
</div>
```

);
}

// ============================================================================
// DELIVERY ANALYZER
// ============================================================================

interface DeliveryAnalyzerProps {
onBack: () => void;
}

function DeliveryAnalyzer({ onBack }: DeliveryAnalyzerProps) {
const [presentation, setPresentation] = useState(â€™â€™);
const [analysis, setAnalysis] = useState<{
stagesHit: number[];
stagesMissed: number[];
feedback: string;
score: number;
} | null>(null);
const [isAnalyzing, setIsAnalyzing] = useState(false);

const analyzePresentation = () => {
setIsAnalyzing(true);

```
// Simulate analysis
setTimeout(() => {
  const lower = presentation.toLowerCase();
  const hit: number[] = [];
  const missed: number[] = [];
  
  PRESENTATION_STAGES.forEach(stage => {
    const hasKeywords = stage.keywords.some(kw => lower.includes(kw.toLowerCase()));
    if (hasKeywords) {
      hit.push(stage.id);
    } else {
      missed.push(stage.id);
    }
  });
  
  const score = Math.round((hit.length / PRESENTATION_STAGES.length) * 100);
  
  setAnalysis({
    stagesHit: hit,
    stagesMissed: missed,
    score,
    feedback: generateDeliveryFeedback(hit, missed, presentation)
  });
  setIsAnalyzing(false);
}, 2000);
```

};

return (
<div className="min-h-screen p-6">
{/* Header */}
<div className="max-w-4xl mx-auto mb-8">
<button
onClick={onBack}
className="flex items-center gap-2 text-slate-400 hover:text-white transition-colors"
>
â† Back to Menu
</button>
</div>

```
  <div className="max-w-4xl mx-auto">
    <div className="bg-slate-800/50 border border-slate-700/50 rounded-2xl overflow-hidden">
      <div className="p-6 border-b border-slate-700/50">
        <h2 className="text-2xl font-bold mb-2">ğŸ“Š Delivery Analyzer</h2>
        <p className="text-slate-400">
          Paste or type your full presentation below. The AI will analyze which 
          stages you covered and provide coaching feedback.
        </p>
      </div>
      
      <div className="p-6">
        <textarea
          value={presentation}
          onChange={(e) => setPresentation(e.target.value)}
          disabled={isAnalyzing}
          placeholder="Type or paste your presentation here...
```

Example: â€˜Ever close the month and feel like somethingâ€™s missing? Like you worked harder than the number shows? Youâ€™re not imagining itâ€¦â€™â€
className=â€œw-full h-64 bg-slate-700/50 border border-slate-600/50 rounded-xl p-4 text-white placeholder-slate-500 focus:outline-none focus:border-purple-500/50 disabled:opacity-50â€
/>

```
        {!analysis && (
          <button
            onClick={analyzePresentation}
            disabled={!presentation.trim() || isAnalyzing}
            className="mt-4 w-full py-3 bg-purple-600 hover:bg-purple-500 disabled:bg-slate-700 disabled:text-slate-500 rounded-xl font-medium transition-colors flex items-center justify-center gap-2"
          >
            {isAnalyzing ? (
              <>
                <span className="animate-spin">â—Œ</span>
                Analyzing...
              </>
            ) : (
              <>ğŸ” Analyze My Presentation</>
            )}
          </button>
        )}
      </div>
      
      {/* Analysis Results */}
      {analysis && (
        <div className="border-t border-slate-700/50 p-6 space-y-6">
          {/* Score */}
          <div className="text-center">
            <div className="inline-flex items-center justify-center w-24 h-24 rounded-full bg-gradient-to-br from-purple-500/20 to-purple-600/20 border-2 border-purple-500/50 mb-4">
              <span className="text-3xl font-bold text-purple-400">{analysis.score}%</span>
            </div>
            <p className="text-slate-400">Stage Coverage</p>
          </div>
          
          {/* Stage Breakdown */}
          <div className="grid md:grid-cols-2 gap-6">
            <div>
              <h4 className="font-medium text-emerald-400 mb-3">âœ… Stages Covered ({analysis.stagesHit.length}/8)</h4>
              <div className="space-y-2">
                {PRESENTATION_STAGES.filter(s => analysis.stagesHit.includes(s.id)).map(stage => (
                  <div key={stage.id} className="p-3 bg-emerald-500/10 border border-emerald-500/30 rounded-lg">
                    <span className="text-emerald-400">{stage.id}. {stage.name}</span>
                  </div>
                ))}
                {analysis.stagesHit.length === 0 && (
                  <p className="text-slate-500 italic">No stages detected</p>
                )}
              </div>
            </div>
            
            <div>
              <h4 className="font-medium text-red-400 mb-3">âŒ Stages Missing ({analysis.stagesMissed.length}/8)</h4>
              <div className="space-y-2">
                {PRESENTATION_STAGES.filter(s => analysis.stagesMissed.includes(s.id)).map(stage => (
                  <div key={stage.id} className="p-3 bg-red-500/10 border border-red-500/30 rounded-lg">
                    <span className="text-red-400">{stage.id}. {stage.name}</span>
                    <p className="text-xs text-slate-500 mt-1">
                      Keywords: {stage.keywords.slice(0, 3).join(', ')}...
                    </p>
                  </div>
                ))}
              </div>
            </div>
          </div>
          
          {/* Feedback */}
          <div className="p-4 bg-purple-500/10 border border-purple-500/30 rounded-xl">
            <h4 className="font-medium text-purple-400 mb-2">ğŸ¤– AI Coach Feedback</h4>
            <p className="text-slate-300 whitespace-pre-wrap">{analysis.feedback}</p>
          </div>
          
          <button
            onClick={() => { setAnalysis(null); setPresentation(''); }}
            className="w-full py-3 bg-slate-700 hover:bg-slate-600 rounded-xl font-medium transition-colors"
          >
            Try Another Presentation
          </button>
        </div>
      )}
    </div>
  </div>
</div>
```

);
}

// ============================================================================
// HELPER FUNCTIONS (Placeholder - Replace with Claude API calls in production)
// ============================================================================

function generateMerchantResponse(
persona: MerchantPersona,
userInput: string,
history: Message[]
): string {
// In production, this would call the Claude API with the personaâ€™s system prompt
// For now, return contextual placeholder responses

const lower = userInput.toLowerCase();

// Check for common patterns and respond accordingly
if (lower.includes(â€˜effective rateâ€™) || lower.includes(â€˜statementâ€™)) {
return â€œMy statement? I meanâ€¦ I guess I could dig it out. What would you even look at?â€;
}

if (lower.includes(â€˜dual pricingâ€™) || lower.includes(â€˜two pricesâ€™)) {
return persona.triggerPhrases[Math.floor(Math.random() * persona.triggerPhrases.length)] +
â€œ How is that different from just charging more?â€;
}

if (lower.includes(â€˜saveâ€™) || lower.includes(â€˜moneyâ€™)) {
return â€œSave money? â€œ + persona.triggerPhrases[0] + â€œ Everyone says that.â€;
}

if (lower.includes(â€˜customerâ€™) || lower.includes(â€˜complaintâ€™)) {
return â€œThatâ€™s exactly what Iâ€™m worried about. My regulars have been coming here for years. What if they get upset?â€;
}

// Default contextual response
const responses = [
â€œOkay, Iâ€™m listening. But make it quick.â€,
â€œInterestingâ€¦ tell me more about that.â€,
â€œIâ€™ve heard something like that before. What makes you different?â€,
â€œMy cousin mentioned something similar. Didnâ€™t work out for him though.â€,
â€œLook, Iâ€™m not saying no. I just need to understand this better.â€
];

return responses[Math.floor(Math.random() * responses.length)];
}

function generateCoachingFeedback(messages: Message[], persona: MerchantPersona): string {
const userMessages = messages.filter(m => m.role === â€˜userâ€™);
const lastFew = userMessages.slice(-3).map(m => m.content).join(â€™ â€™);
const lower = lastFew.toLowerCase();

let feedback = `<h4 class="font-bold text-emerald-400 mb-2">Session Analysis</h4>`;

// Check for good patterns
const goods: string[] = [];
const improvements: string[] = [];

if (lower.includes(â€˜feelâ€™) || lower.includes(â€˜frustratâ€™)) {
goods.push(â€œGood use of emotional languageâ€);
}
if (lower.includes(â€™?â€™)) {
goods.push(â€œAsking questions keeps them engagedâ€);
}
if (!lower.includes(â€˜saveâ€™) && !lower.includes(â€˜cheapâ€™)) {
goods.push(â€œAvoiding price-first languageâ€);
}

// Check for areas to improve
if (lower.includes(â€˜our productâ€™) || lower.includes(â€˜we offerâ€™)) {
improvements.push(â€œAvoid â€˜weâ€™ languageâ€”make it about THEMâ€);
}
if (lower.length < 100) {
improvements.push(â€œYour responses might be too shortâ€”build more rapportâ€);
}
if (!lower.includes(persona.name.split(â€™ â€™)[0].toLowerCase())) {
improvements.push(â€œTry using their name to build connectionâ€);
}

if (goods.length > 0) {
feedback += `<p class="text-slate-300 mb-3"><strong class="text-emerald-400">Strengths:</strong> ${goods.join(', ')}</p>`;
}

if (improvements.length > 0) {
feedback += `<p class="text-slate-300 mb-3"><strong class="text-yellow-400">Areas to improve:</strong> ${improvements.join('. ')}</p>`;
}

feedback += `<p class="text-slate-400 text-sm mt-4">Remember: ${persona.name} responds best to: ${persona.weakPoints[0]}</p>`;

return feedback;
}

function generateDeliveryFeedback(hit: number[], missed: number[], presentation: string): string {
if (hit.length === 8) {
return â€œExcellent! You covered all 8 stages. Focus now on delivery: pacing, pauses after key numbers, and emotional tone.â€;
}

if (missed.includes(1)) {
return â€œYouâ€™re missing the Visceral Opening. Start with emotion BEFORE facts. â€˜Ever close the month and feel that knot in your stomach?â€™ Hook them first.â€;
}

if (missed.includes(5)) {
return â€œThe Three Options Framework is missing. You need to present interchange-plus, surcharging, and Dual Pricing as choicesâ€”not just pitch one solution.â€;
}

if (missed.includes(7)) {
return â€œYou skipped Mikeâ€™s story. Proof stories make the transformation real. â€˜Mike runs an HVAC company. Same situation as youâ€¦â€™â€;
}

if (hit.length < 4) {
return `You're only hitting ${hit.length} of 8 stages. Your presentation may feel incomplete. Focus on adding the missing elements in orderâ€”each stage builds on the previous one.`;
}

return `Good progressâ€”you're covering ${hit.length}/8 stages. The missing stages (${missed.join(', ')}) are important for a complete presentation. Practice adding them in sequence.`;
}

// ============================================================================
// CLAUDE API INTEGRATION (Production Implementation)
// ============================================================================

/**

- This function shows how to integrate with Claude API for dynamic roleplay.
- Replace the generateMerchantResponse placeholder above with this in production.
  */
  async function callClaudeForMerchantResponse(
  persona: MerchantPersona,
  conversationHistory: Message[]
  ): Promise<string> {
  const response = await fetch(â€˜https://api.anthropic.com/v1/messagesâ€™, {
  method: â€˜POSTâ€™,
  headers: {
  â€˜Content-Typeâ€™: â€˜application/jsonâ€™,
  // API key should be handled server-side in production
  },
  body: JSON.stringify({
  model: â€˜claude-sonnet-4-20250514â€™,
  max_tokens: 1000,
  system: persona.systemPrompt + `

IMPORTANT RULES:

1. Stay in character as ${persona.name} at all times
1. Respond naturally as this merchant would - use their speech patterns and concerns
1. Donâ€™t make it easy - use your objection style: â€œ${persona.objectionStyle}â€
1. If the rep does something that aligns with your weak points (${persona.weakPoints.join(â€™, â€™)}), start to warm up slightly
1. Keep responses concise - 1-3 sentences typically, unless really engaged
1. Never break character or give sales advice`,
   messages: conversationHistory.map(m => ({
   role: m.role === â€˜userâ€™ ? â€˜userâ€™ : â€˜assistantâ€™,
   content: m.content
   }))
   })
   });

const data = await response.json();
return data.content[0].text;
}

/**

- For coaching feedback, use this Claude API call
  */
  async function callClaudeForCoaching(
  conversationHistory: Message[],
  persona: MerchantPersona
  ): Promise<string> {
  const response = await fetch(â€˜https://api.anthropic.com/v1/messagesâ€™, {
  method: â€˜POSTâ€™,
  headers: {
  â€˜Content-Typeâ€™: â€˜application/jsonâ€™,
  },
  body: JSON.stringify({
  model: â€˜claude-sonnet-4-20250514â€™,
  max_tokens: 1000,
  system: `You are a sales coach analyzing a roleplay session. The rep was practicing with ${persona.name}, a ${persona.difficulty} difficulty merchant.

Persona details:

- Personality: ${persona.personality}
- Objection style: ${persona.objectionStyle}
- Weak points: ${persona.weakPoints.join(â€™, â€™)}

Analyze the repâ€™s performance and provide:

1. 2-3 specific things they did well
1. 2-3 specific areas to improve
1. One concrete suggestion for their next exchange

Be specific and actionable. Reference actual things they said.`, messages: [{ role: 'user', content: `Hereâ€™s the conversation:\n\n${conversationHistory.map(m =>
`${m.role === 'user' ? 'REP' : 'MERCHANT'}: ${m.content}`
).join(â€™\n\nâ€™)}`
}]
})
});

const data = await response.json();
return data.content[0].text;
}