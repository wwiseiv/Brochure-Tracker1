# Phase 4: Polish — Help Menu, AI Assistant, Tooltips, QA

## PREREQUISITE
Phases 1-3 must be complete. All three modes (Template-Fill, AI-Custom) must be generating correct PDFs. All stepper steps must be functional.

---

## SCOPE — WHAT THIS PHASE DELIVERS
1. Help menu updated with One-Page Proposal documentation
2. AI help assistant updated with feature knowledge
3. Tooltips added throughout the new feature
4. Mobile responsiveness audit and fixes
5. Edge case handling and error states
6. Full regression test of existing features
7. Code cleanup and developer documentation

---

## 4.1 Help Menu Update

Locate the help menu content (identified in Phase 0) and add an entry for the new feature.

**Content to add:**

```
### One-Page Proposal

Quickly generate professional one-page proposals and flyers from pre-designed templates. 

**How to use:**
1. Go to Proposal Generator → One-Page Proposal tab
2. Choose from 7 professional templates (savings proposals, payroll offers, marketing audit flyers, video brochure flyers, and referral partner pitches)
3. Enter the merchant's business name
4. Optionally upload analysis documents to include real savings numbers
5. Select recommended equipment from Equipment IQ
6. Review your contact info
7. Generate and download your one-page PDF

**Two modes available:**
- **Template-Fill:** Fast, deterministic — fills in your data with no AI rewriting. Best when you just need a clean proposal with real numbers.
- **AI-Custom:** Uses AI to customize the headline and copy for the merchant's specific business type. Optionally provide the merchant's website URL for more targeted messaging. Falls back to Template-Fill if AI is unavailable.

**Templates available:**
- Exclusive Offer (Standard) — savings breakdown with equipment
- Exclusive Offer (QR Code) — same with QR code for video offer
- Referral Program (Client-Facing) — for enrolled agent client pitches
- Enrolled Agent Referral — headline-focused referral pitch
- Free Payroll for 12 Months — payroll promotion flyer
- What's Your Business Grade? — free marketing audit offer
- The Best 5 Minutes — video brochure offer flyer

**Tips:**
- Upload a Dual Pricing AND Interchange Plus analysis to get a side-by-side comparison on the proposal
- Your contact info is pulled from your profile — update it in Settings if it's not current
- The system never invents savings numbers — if you don't upload analysis docs, the savings section will use generic language
```

### 4.2 AI Help Assistant Update

Locate the AI help assistant's knowledge base or system prompt (identified in Phase 0) and add context about the new feature.

**Add to assistant's knowledge:**

```
FEATURE: One-Page Proposal (inside Proposal Generator)
- Third tab in Proposal Generator, alongside AI Workflow and Manual Upload
- Generates professional one-page PDF proposals/flyers from 7 pre-designed templates
- Two modes: Template-Fill (fast, no AI) and AI-Custom (AI-tailored copy)
- Supports optional document uploads: merchant statement, dual pricing analysis, interchange plus analysis
- Integrates with Equipment IQ for equipment recommendations
- Agent contact info auto-populates from user profile and can be edited before generation
- Templates include: Exclusive Offer (2 variants), Referral Program (2 variants), Free Payroll, Business Grade Audit, Video Brochure Flyer
- Governed by the existing Proposal Generator permission — no separate toggle needed
- If both dual pricing and interchange plus analyses are uploaded, output includes a comparison block
- The system never fabricates financial numbers
```

### 4.3 Tooltips

Add tooltips to the following elements (match existing tooltip style/component):

| Element | Tooltip Text |
|---------|-------------|
| "One-Page Proposal" tab | "Generate a professional one-page proposal or flyer from a template" |
| Template-Fill mode radio | "Fills your data directly into the template — fast and reliable" |
| AI-Custom mode radio | "AI customizes the copy for the merchant's business type" |
| Website URL field | "Optional — provide the merchant's website so AI can tailor the messaging to their industry" |
| Merchant Statement upload | "Upload the merchant's current processing statement (PDF)" |
| Dual Pricing Analysis upload | "Upload a dual pricing savings analysis (PDF) to include specific savings numbers" |
| Interchange Plus Analysis upload | "Upload an interchange plus analysis (PDF) to include specific savings numbers" |
| Equipment IQ selector | "Choose recommended equipment to feature on the proposal" |
| Contact Info step | "This info will appear on the proposal — verify it's correct before generating" |
| Generate button | "Create your one-page PDF proposal" |

### 4.4 Mobile Responsiveness Audit

The app is used on phones. Verify and fix:

- [ ] Template grid: 1 column on small phones, 2 on larger phones/tablets
- [ ] Stepper navigation: full-width Back/Next buttons with adequate spacing
- [ ] Step indicator: compact on mobile (just numbers or dots, not full labels)
- [ ] Form fields: full-width inputs, proper keyboard types (email for email, url for URL, tel for phone)
- [ ] Upload slots: large enough touch targets, clear feedback on upload success
- [ ] Equipment selector: scrollable and easy to tap on mobile
- [ ] Contact info form: no horizontal scrolling
- [ ] Generated PDF preview: pinch-to-zoom or a "Download" CTA if preview doesn't fit well on mobile
- [ ] Overall: no horizontal overflow on any step at 375px viewport width

### 4.5 Edge Case Handling

Verify these edge cases work correctly:

**Upload edge cases:**
- Upload a non-PDF file → clear error message, upload rejected
- Upload a very large PDF (>25MB or whatever the app limit is) → clear error message
- Upload a PDF that has no extractable text (scanned image PDF) → extraction returns empty, generation proceeds without numbers, no crash
- Upload then remove a file → slot clears, generation adjusts accordingly
- Upload a corrupt/invalid PDF → error message, proceed without that document

**Generation edge cases:**
- Very long merchant name → truncated or font size reduced, doesn't overflow template
- Missing agent email → inline warning shown, generation still allowed
- No equipment selected → equipment section uses generic text or is omitted
- All optional fields empty → generates a clean generic proposal from template defaults
- AI-Custom mode with no website URL → AI generates based on merchant name and uploaded docs only
- AI-Custom mode with invalid URL → scrape fails gracefully, generates without website context

**Permission edge cases:**
- Agent with Proposal Generator OFF tries to navigate directly to URL → redirected or blocked
- Agent switches from Trainee to Agent role → permissions update correctly

**Session edge cases:**
- Agent starts the wizard, navigates away, comes back → reasonable behavior (either preserved state or clean restart)
- Browser refresh mid-wizard → handled gracefully

### 4.6 Full Regression Test

Run through these tests manually:

**Existing features (must pass):**
- [ ] AI Workflow tab: complete a full AI workflow proposal generation
- [ ] Manual Upload tab: upload a proposal manually
- [ ] Proposal Generator page load time is not noticeably slower
- [ ] Tab switching between all three tabs is instant
- [ ] Marketing Materials feature still works (contact overlay not broken)
- [ ] Equipment IQ feature still works independently

**New feature (must pass):**
- [ ] Template selector: all 7 templates display with thumbnails
- [ ] Template-Fill: generate with all fields populated → correct PDF
- [ ] Template-Fill: generate with no optional fields → clean generic PDF
- [ ] Template-Fill: generate with dual pricing only → correct PDF
- [ ] Template-Fill: generate with interchange only → correct PDF
- [ ] Template-Fill: generate with both analyses → comparison block in PDF
- [ ] AI-Custom: generate with website URL → customized copy in PDF
- [ ] AI-Custom: generate without website URL → still generates
- [ ] AI-Custom: AI call fails → falls back to Template-Fill with notification
- [ ] Download works
- [ ] Preview works
- [ ] Permission: feature hidden when Proposal Generator is OFF
- [ ] Mobile: complete full wizard on 375px viewport

### 4.7 Code Cleanup & Developer Documentation

**In-code comments (required):**
- Top of OnePageProposal main component: brief description of the feature
- Template metadata config: how to add new templates
- PDF generation service: how the overlay/generation pipeline works
- Coordinate maps: note that these may need manual adjustment for new templates

**README section or developer note (in the project):**

```markdown
## One-Page Proposal (Proposal Generator — 3rd Tab)

### Template Storage
- Individual template PDFs: [path]
- Template thumbnails: [path]
- Template metadata/config: [path]

### Adding New Templates
1. Design the template in Canva (or similar) as a single-page PDF
2. Add the PDF to [template storage path]
3. Generate a thumbnail (PNG, ~400px wide)
4. Add a metadata entry to [config file path] with:
   - templateId, displayName, category, description
   - Field coordinate map (x, y, fontSize for each dynamic text field)
5. Test generation with sample data

### How Generation Works
- Template-Fill: Loads base PDF → overlays text at defined coordinates → saves output
- AI-Custom: Assembles context → calls AI for customized copy → overlays AI text at same coordinates → saves output
- Contact info overlay uses the same method as Marketing Materials feature ([path to shared utility])

### Coordinate Maps
Each template has a field position map in [config path]. Coordinates are in PDF points (origin: bottom-left of page). Adjust by:
1. Open the base template PDF in a PDF viewer that shows coordinates
2. Note the x,y position where each text field should start
3. Update the coordinate map
4. Re-test generation
```

---

## ACCEPTANCE CRITERIA FOR PHASE 4

- [ ] Help menu includes One-Page Proposal documentation
- [ ] AI help assistant can explain the feature when asked
- [ ] All tooltips present and match existing style
- [ ] Mobile responsive at 375px viewport — full wizard completable
- [ ] All edge cases handled without crashes
- [ ] Full regression test passes (existing + new features)
- [ ] Developer documentation added (in-code + README section)
- [ ] No console errors or warnings
- [ ] No unused imports or dead code from development

---

## FINAL DELIVERY

After Phase 4, the feature is complete. Summarize:
1. All files created and modified
2. Any known limitations or areas for future improvement
3. Confirm all 4 phase acceptance criteria met
